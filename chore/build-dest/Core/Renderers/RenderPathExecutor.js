import JThreeObjectEE from "../../Base/JThreeObjectEE";
import JThreeContext from "../../JThreeContext";
import ContextComponents from "../../ContextComponents";
import Mesh from "../SceneObjects/Mesh";
/**
 * All rendering path should be executed with this class.
 *
 * @type {[type]}
 */
class RenderPathExecutor extends JThreeObjectEE {
    constructor(parent) {
        super();
        this.renderer = parent;
    }
    processRender(scene, renderPath) {
        let stageIndex = 0;
        renderPath.path.forEach(chain => {
            try {
                const texs = this._genChainTexture(chain);
                const stage = chain.stage;
                const techniqueCount = stage.getTechniqueCount(scene);
                let targetObjects;
                stage.preStage(scene, texs);
                for (let techniqueIndex = 0; techniqueIndex < techniqueCount; techniqueIndex++) {
                    switch (stage.getTarget(techniqueIndex)) {
                        case "scene":
                            targetObjects = scene.children;
                            break;
                        default:
                            const pr = JThreeContext.getContextComponent(ContextComponents.PrimitiveRegistory);
                            const geometry = pr.getPrimitive(stage.getTarget(techniqueIndex));
                            if (!geometry) {
                                console.error(`Unknown primitive ${stage.getTarget(techniqueIndex)} was specified!`);
                                continue;
                            }
                            else {
                                targetObjects = [new Mesh(geometry, null)];
                            }
                    }
                    stage.stageVariables = chain.variables;
                    stage.preTechnique(scene, techniqueIndex, texs);
                    this._renderObjects(targetObjects, stage, scene, techniqueCount, techniqueIndex, texs, chain);
                    stage.postTechnique(scene, techniqueIndex, texs);
                }
                stage.postStage(scene, texs);
                this.emit("rendered-stage", {
                    owner: this,
                    completedChain: chain,
                    bufferTextures: texs,
                    index: stageIndex
                });
                stageIndex++;
            }
            catch (e) {
                throw e;
            }
        });
        this.emit("rendered-path", {
            owner: this,
            scene: scene
        });
    }
    _renderObjects(targetObjects, stage, scene, techniqueCount, techniqueIndex, texs, chain) {
        targetObjects.forEach(v => {
            v.callRecursive(_v => {
                if (_v.Geometry && stage.needRender(scene, _v, techniqueIndex)) {
                    stage.render(scene, _v, techniqueCount, techniqueIndex, texs);
                    this.emit("rendered-object", {
                        owner: this,
                        renderedObject: _v,
                        stage: stage,
                        stageChain: chain,
                        bufferTextures: texs,
                        technique: techniqueIndex
                    });
                }
            });
        });
    }
    _genChainTexture(chain) {
        const texInfo = {};
        for (let targetName in chain.buffers) {
            const bufferName = chain.buffers[targetName];
            if (bufferName === "default") {
                texInfo[targetName] = null; // default buffer
                continue;
            }
            const tex = this.renderer.bufferSet.getColorBuffer(bufferName);
            texInfo[targetName] = tex;
        }
        return texInfo;
    }
}
export default RenderPathExecutor;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNvcmUvUmVuZGVyZXJzL1JlbmRlclBhdGhFeGVjdXRvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiT0FBTyxjQUFjLE1BQU0sMkJBQTJCO09BRy9DLGFBQWEsTUFBTSxxQkFBcUI7T0FDeEMsaUJBQWlCLE1BQU0seUJBQXlCO09BSWhELElBQUksTUFBTSxzQkFBc0I7QUFPdkM7Ozs7R0FJRztBQUNILGlDQUFpQyxjQUFjO0lBRzdDLFlBQVksTUFBcUI7UUFDL0IsT0FBTyxDQUFDO1FBQ1IsSUFBSSxDQUFDLFFBQVEsR0FBRyxNQUFNLENBQUM7SUFDekIsQ0FBQztJQUVNLGFBQWEsQ0FBQyxLQUFZLEVBQUUsVUFBc0I7UUFDdkQsSUFBSSxVQUFVLEdBQUcsQ0FBQyxDQUFDO1FBQ25CLFVBQVUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUs7WUFDM0IsSUFBSSxDQUFDO2dCQUNILE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDMUMsTUFBTSxLQUFLLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQztnQkFDMUIsTUFBTSxjQUFjLEdBQUcsS0FBSyxDQUFDLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUN0RCxJQUFJLGFBQTRCLENBQUM7Z0JBQ2pDLEtBQUssQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO2dCQUM1QixHQUFHLENBQUMsQ0FBQyxJQUFJLGNBQWMsR0FBRyxDQUFDLEVBQUUsY0FBYyxHQUFHLGNBQWMsRUFBRSxjQUFjLEVBQUUsRUFBRSxDQUFDO29CQUMvRSxNQUFNLENBQUMsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFDeEMsS0FBSyxPQUFPOzRCQUNWLGFBQWEsR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDOzRCQUMvQixLQUFLLENBQUM7d0JBQ1I7NEJBQ0UsTUFBTSxFQUFFLEdBQUcsYUFBYSxD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QztZQUNyQyxNQUFNLFVBQVUsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQzdDLEVBQUUsQ0FBQyxDQUFDLFVBQVUsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDO2dCQUM3QixPQUFPLENBQUMsVUFBVSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsaUJBQWlCO2dCQUM3QyxRQUFRLENBQUM7WUFDWCxDQUFDO1lBQ0QsTUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQy9ELE9BQU8sQ0FBQyxVQUFVLENBQUMsR0FBRyxHQUFHLENBQUM7UUFDNUIsQ0FBQztRQUNELE1BQU0sQ0FBQyxPQUFPLENBQUM7SUFDakIsQ0FBQztBQUVILENBQUM7QUFFRCxlQUFlLGtCQUFrQixDQUFDIiwiZmlsZSI6IkNvcmUvUmVuZGVyZXJzL1JlbmRlclBhdGhFeGVjdXRvci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBKVGhyZWVPYmplY3RFRSBmcm9tIFwiLi4vLi4vQmFzZS9KVGhyZWVPYmplY3RFRVwiO1xuaW1wb3J0IFJlbmRlclN0YWdlQmFzZSBmcm9tIFwiLi9SZW5kZXJTdGFnZXMvUmVuZGVyU3RhZ2VCYXNlXCI7XG5pbXBvcnQgUHJpbWl0aXZlUmVnaXN0b3J5IGZyb20gXCIuLi9HZW9tZXRyaWVzL0Jhc2UvUHJpbWl0aXZlUmVnaXN0b3J5XCI7XG5pbXBvcnQgSlRocmVlQ29udGV4dCBmcm9tIFwiLi4vLi4vSlRocmVlQ29udGV4dFwiO1xuaW1wb3J0IENvbnRleHRDb21wb25lbnRzIGZyb20gXCIuLi8uLi9Db250ZXh0Q29tcG9uZW50c1wiO1xuaW1wb3J0IEJhc2ljUmVuZGVyZXIgZnJvbSBcIi4vQmFzaWNSZW5kZXJlclwiO1xuaW1wb3J0IFJlbmRlclN0YWdlQ2hhaW4gZnJvbSBcIi4vUmVuZGVyU3RhZ2VDaGFpblwiO1xuaW1wb3J0IFNjZW5lT2JqZWN0IGZyb20gXCIuLi9TY2VuZU9iamVjdHMvU2NlbmVPYmplY3RcIjtcbmltcG9ydCBNZXNoIGZyb20gXCIuLi9TY2VuZU9iamVjdHMvTWVzaFwiO1xuaW1wb3J0IFNjZW5lIGZyb20gXCIuLi9TY2VuZVwiO1xuaW1wb3J0IFJlc29sdmVkQ2hhaW5JbmZvIGZyb20gXCIuL1Jlc29sdmVkQ2hhaW5JbmZvXCI7XG5pbXBvcnQgUmVuZGVyUGF0aCBmcm9tIFwiLi9SZW5kZXJQYXRoXCI7XG5pbXBvcnQgSVJlbmRlclN0YWdlQ29tcGxldGVkRXZlbnRBcmdzIGZyb20gXCIuL0lSZW5kZXJTdGFnZUNvbXBsZXRlZEV2ZW50QXJnc1wiO1xuaW1wb3J0IElSZW5kZXJQYXRoQ29tcGxldGVkRXZlbnRBcmdzIGZyb20gXCIuL0lSZW5kZXJQYXRoQ29tcGxldGVkRXZlbnRBcmdzXCI7XG5pbXBvcnQgSVJlbmRlck9iamVjdENvbXBsZXRlZEV2ZW50QXJncyBmcm9tIFwiLi9JUmVuZGVyT2JqZWN0Q29tcGxldGVkRXZlbnRBcmdzXCI7XG4vKipcbiAqIEFsbCByZW5kZXJpbmcgcGF0aCBzaG91bGQgYmUgZXhlY3V0ZWQgd2l0aCB0aGlzIGNsYXNzLlxuICpcbiAqIEB0eXBlIHtbdHlwZV19XG4gKi9cbmNsYXNzIFJlbmRlclBhdGhFeGVjdXRvciBleHRlbmRzIEpUaHJlZU9iamVjdEVFIHtcbiAgcHVibGljIHJlbmRlcmVyOiBCYXNpY1JlbmRlcmVyO1xuXG4gIGNvbnN0cnVjdG9yKHBhcmVudDogQmFzaWNSZW5kZXJlcikge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5yZW5kZXJlciA9IHBhcmVudDtcbiAgfVxuXG4gIHB1YmxpYyBwcm9jZXNzUmVuZGVyKHNjZW5lOiBTY2VuZSwgcmVuZGVyUGF0aDogUmVuZGVyUGF0aCk6IHZvaWQge1xuICAgIGxldCBzdGFnZUluZGV4ID0gMDtcbiAgICByZW5kZXJQYXRoLnBhdGguZm9yRWFjaChjaGFpbiA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB0ZXhzID0gdGhpcy5fZ2VuQ2hhaW5UZXh0dXJlKGNoYWluKTtcbiAgICAgICAgY29uc3Qgc3RhZ2UgPSBjaGFpbi5zdGFnZTtcbiAgICAgICAgY29uc3QgdGVjaG5pcXVlQ291bnQgPSBzdGFnZS5nZXRUZWNobmlxdWVDb3VudChzY2VuZSk7XG4gICAgICAgIGxldCB0YXJnZXRPYmplY3RzOiBTY2VuZU9iamVjdFtdO1xuICAgICAgICBzdGFnZS5wcmVTdGFnZShzY2VuZSwgdGV4cyk7XG4gICAgICAgIGZvciAobGV0IHRlY2huaXF1ZUluZGV4ID0gMDsgdGVjaG5pcXVlSW5kZXggPCB0ZWNobmlxdWVDb3VudDsgdGVjaG5pcXVlSW5kZXgrKykge1xuICAgICAgICAgIHN3aXRjaCAoc3RhZ2UuZ2V0VGFyZ2V0KHRlY2huaXF1ZUluZGV4KSkge1xuICAgICAgICAgICAgY2FzZSBcInNjZW5lXCI6XG4gICAgICAgICAgICAgIHRhcmdldE9iamVjdHMgPSBzY2VuZS5jaGlsZHJlbjtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICBjb25zdCBwciA9IEpUaHJlZUNvbnRleHQuZ2V0Q29udGV4dENvbXBvbmVudDxQcmltaXRpdmVSZWdpc3Rvcnk+KENvbnRleHRDb21wb25lbnRzLlByaW1pdGl2ZVJlZ2lzdG9yeSk7XG4gICAgICAgICAgICAgIGNvbnN0IGdlb21ldHJ5ID0gcHIuZ2V0UHJpbWl0aXZlKHN0YWdlLmdldFRhcmdldCh0ZWNobmlxdWVJbmRleCkpO1xuICAgICAgICAgICAgICBpZiAoIWdlb21ldHJ5KSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgVW5rbm93biBwcmltaXRpdmUgJHtzdGFnZS5nZXRUYXJnZXQodGVjaG5pcXVlSW5kZXgpIH0gd2FzIHNwZWNpZmllZCFgKTtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0YXJnZXRPYmplY3RzID0gW25ldyBNZXNoKGdlb21ldHJ5LCBudWxsKV07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgc3RhZ2Uuc3RhZ2VWYXJpYWJsZXMgPSBjaGFpbi52YXJpYWJsZXM7XG4gICAgICAgICAgc3RhZ2UucHJlVGVjaG5pcXVlKHNjZW5lLCB0ZWNobmlxdWVJbmRleCwgdGV4cyk7XG4gICAgICAgICAgdGhpcy5fcmVuZGVyT2JqZWN0cyh0YXJnZXRPYmplY3RzLCBzdGFnZSwgc2NlbmUsIHRlY2huaXF1ZUNvdW50LCB0ZWNobmlxdWVJbmRleCwgdGV4cywgY2hhaW4pO1xuICAgICAgICAgIHN0YWdlLnBvc3RUZWNobmlxdWUoc2NlbmUsIHRlY2huaXF1ZUluZGV4LCB0ZXhzKTtcbiAgICAgICAgfVxuICAgICAgICBzdGFnZS5wb3N0U3RhZ2Uoc2NlbmUsIHRleHMpO1xuICAgICAgICB0aGlzLmVtaXQoXCJyZW5kZXJlZC1zdGFnZVwiLCA8SVJlbmRlclN0YWdlQ29tcGxldGVkRXZlbnRBcmdzPntcbiAgICAgICAgICBvd25lcjogdGhpcyxcbiAgICAgICAgICBjb21wbGV0ZWRDaGFpbjogY2hhaW4sXG4gICAgICAgICAgYnVmZmVyVGV4dHVyZXM6IHRleHMsXG4gICAgICAgICAgaW5kZXg6IHN0YWdlSW5kZXhcbiAgICAgICAgfSk7XG4gICAgICAgIHN0YWdlSW5kZXgrKztcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgdGhyb3cgZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICB0aGlzLmVtaXQoXCJyZW5kZXJlZC1wYXRoXCIsIDxJUmVuZGVyUGF0aENvbXBsZXRlZEV2ZW50QXJncz4ge1xuICAgICAgb3duZXI6IHRoaXMsXG4gICAgICBzY2VuZTogc2NlbmVcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgX3JlbmRlck9iamVjdHModGFyZ2V0T2JqZWN0czogU2NlbmVPYmplY3RbXSwgc3RhZ2U6IFJlbmRlclN0YWdlQmFzZSwgc2NlbmU6IFNjZW5lLCB0ZWNobmlxdWVDb3VudDogbnVtYmVyLCB0ZWNobmlxdWVJbmRleDogbnVtYmVyLCB0ZXhzOiBSZXNvbHZlZENoYWluSW5mbywgY2hhaW46IFJlbmRlclN0YWdlQ2hhaW4pOiB2b2lkIHtcbiAgICB0YXJnZXRPYmplY3RzLmZvckVhY2godiA9PiB7XG4gICAgICB2LmNhbGxSZWN1cnNpdmUoX3YgPT4ge1xuICAgICAgICBpZiAoX3YuR2VvbWV0cnkgJiYgc3RhZ2UubmVlZFJlbmRlcihzY2VuZSwgX3YsIHRlY2huaXF1ZUluZGV4KSkge1xuICAgICAgICAgIHN0YWdlLnJlbmRlcihzY2VuZSwgX3YsIHRlY2huaXF1ZUNvdW50LCB0ZWNobmlxdWVJbmRleCwgdGV4cyk7XG4gICAgICAgICAgdGhpcy5lbWl0KFwicmVuZGVyZWQtb2JqZWN0XCIsIDxJUmVuZGVyT2JqZWN0Q29tcGxldGVkRXZlbnRBcmdzPntcbiAgICAgICAgICAgIG93bmVyOiB0aGlzLFxuICAgICAgICAgICAgcmVuZGVyZWRPYmplY3Q6IF92LFxuICAgICAgICAgICAgc3RhZ2U6IHN0YWdlLFxuICAgICAgICAgICAgc3RhZ2VDaGFpbjogY2hhaW4sXG4gICAgICAgICAgICBidWZmZXJUZXh0dXJlczogdGV4cyxcbiAgICAgICAgICAgIHRlY2huaXF1ZTogdGVjaG5pcXVlSW5kZXhcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIF9nZW5DaGFpblRleHR1cmUoY2hhaW46IFJlbmRlclN0YWdlQ2hhaW4pOiBSZXNvbHZlZENoYWluSW5mbyB7XG4gICAgY29uc3QgdGV4SW5mbzogUmVzb2x2ZWRDaGFpbkluZm8gPSB7fTtcbiAgICBmb3IgKGxldCB0YXJnZXROYW1lIGluIGNoYWluLmJ1ZmZlcnMpIHtcbiAgICAgIGNvbnN0IGJ1ZmZlck5hbWUgPSBjaGFpbi5idWZmZXJzW3RhcmdldE5hbWVdO1xuICAgICAgaWYgKGJ1ZmZlck5hbWUgPT09IFwiZGVmYXVsdFwiKSB7XG4gICAgICAgIHRleEluZm9bdGFyZ2V0TmFtZV0gPSBudWxsOyAvLyBkZWZhdWx0IGJ1ZmZlclxuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHRleCA9IHRoaXMucmVuZGVyZXIuYnVmZmVyU2V0LmdldENvbG9yQnVmZmVyKGJ1ZmZlck5hbWUpO1xuICAgICAgdGV4SW5mb1t0YXJnZXROYW1lXSA9IHRleDtcbiAgICB9XG4gICAgcmV0dXJuIHRleEluZm87XG4gIH1cblxufVxuXG5leHBvcnQgZGVmYXVsdCBSZW5kZXJQYXRoRXhlY3V0b3I7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=

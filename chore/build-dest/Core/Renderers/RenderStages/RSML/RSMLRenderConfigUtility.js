import Vector4 from "../../../../Math/Vector4";
class RSMLRenderConfigUtility {
    static parseFBOConfiguration(fboElement, canvas) {
        if (!fboElement) {
            return undefined;
        }
        const result = {};
        const primary = fboElement.getAttribute("primary");
        const colorNodes = fboElement.getElementsByTagName("color");
        const rboNode = fboElement.getElementsByTagName("rbo").item(0);
        result.primaryName = primary;
        for (let i = 0; i < colorNodes.length; i++) {
            const colorBuffer = RSMLRenderConfigUtility._parseColorBuffer(colorNodes.item(i), canvas);
            result[colorBuffer.registerIndex] = colorBuffer;
            if (colorBuffer.name === primary) {
                result.primaryIndex = colorBuffer.registerIndex;
            }
        }
        result.rbo = RSMLRenderConfigUtility._parseRenderBuffer(rboNode);
        return result;
    }
    static _parseColorBuffer(colorElement, canvas) {
        // Retrive buffer name to be bound
        const name = colorElement.getAttribute("name");
        if (!name) {
            console.error("The name attribute in color node must be specified!");
            return null;
        }
        // Retrive register index
        const registerStr = colorElement.getAttribute("register");
        let registerIndex = 0;
        if (registerStr) {
            registerIndex = parseInt(registerStr, 10);
        }
        // Retrive clear flag
        const clearStr = colorElement.getAttribute("clear");
        const clearFlag = clearStr !== "false";
        // Retrive clear color
        let clearColor;
        if (clearFlag) {
            const colorStr = colorElement.getAttribute("clearColor");
            clearColor = new Vector4(0, 0, 0, 0);
            if (colorStr) {
                if (colorStr === "default") {
                    clearColor = canvas.clearColor.toVector();
                }
                else {
                    clearColor = Vector4.parse(colorStr);
                }
            }
        }
        return {
            name: name,
            registerIndex: registerIndex,
            clearColor: clearColor,
            needClear: clearFlag
        };
    }
    static _parseRenderBuffer(rboElement) {
        if (!rboElement) {
            return undefined;
        }
        // Retrive buffer name to be bound
        let name = rboElement.getAttribute("name");
        if (!name) {
            name = "default";
        }
        let type = rboElement.getAttribute("type");
        if (!type) {
            type = "depth";
        }
        let clearStr = rboElement.getAttribute("clear");
        const clearFlag = clearStr !== "false";
        let clearDepth;
        if (clearFlag) {
            const depthStr = rboElement.getAttribute("clearDepth");
            clearDepth = 1.0;
            if (depthStr) {
                clearDepth = parseFloat(depthStr);
            }
        }
        return {
            name: name,
            type: type,
            needClear: clearFlag,
            clearDepth: clearDepth
        };
    }
}
export default RSMLRenderConfigUtility;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNvcmUvUmVuZGVyZXJzL1JlbmRlclN0YWdlcy9SU01ML1JTTUxSZW5kZXJDb25maWdVdGlsaXR5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJPQUdPLE9BQU8sTUFBTSwwQkFBMEI7QUFFOUM7SUFDRSxPQUFjLHFCQUFxQixDQUFDLFVBQW1CLEVBQUUsTUFBYztRQUNyRSxFQUFFLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7WUFDaEIsTUFBTSxDQUFDLFNBQVMsQ0FBQztRQUNuQixDQUFDO1FBQ0QsTUFBTSxNQUFNLEdBQXNCLEVBQUUsQ0FBQztRQUNyQyxNQUFNLE9BQU8sR0FBRyxVQUFVLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ25ELE1BQU0sVUFBVSxHQUFHLFVBQVUsQ0FBQyxvQkFBb0IsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUM1RCxNQUFNLE9BQU8sR0FBRyxVQUFVLENBQUMsb0JBQW9CLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQy9ELE1BQU0sQ0FBQyxXQUFXLEdBQUcsT0FBTyxDQUFDO1FBQzdCLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsVUFBVSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQzNDLE1BQU0sV0FBVyxHQUFHLHVCQUF1QixDQUFDLGlCQUFpQixDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFDMUYsTUFBTSxDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsR0FBRyxXQUFXLENBQUM7WUFDaEQsRUFBRSxDQUFDLENBQUMsV0FBVyxDQUFDLElBQUksS0FBSyxPQUFPLENBQUMsQ0FBQyxDQUFDO2dCQUNqQyxNQUFNLENBQUMsWUFBWSxHQUFHLFdBQVcsQ0FBQyxhQUFhLENBQUM7WUFDbEQsQ0FBQztRQUNILENBQUM7UUFDRCxN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QUFVLENBQUMsWUFBWSxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ3ZELFVBQVUsR0FBRyxHQUFHLENBQUM7WUFDakIsRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztnQkFDYixVQUFVLEdBQUcsVUFBVSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3BDLENBQUM7UUFDSCxDQUFDO1FBQ0QsTUFBTSxDQUFDO1lBQ0wsSUFBSSxFQUFFLElBQUk7WUFDVixJQUFJLEVBQUUsSUFBSTtZQUNWLFNBQVMsRUFBRSxTQUFTO1lBQ3BCLFVBQVUsRUFBRSxVQUFVO1NBQ3ZCLENBQUM7SUFDSixDQUFDO0FBQ0gsQ0FBQztBQUVELGVBQWUsdUJBQXVCLENBQUMiLCJmaWxlIjoiQ29yZS9SZW5kZXJlcnMvUmVuZGVyU3RhZ2VzL1JTTUwvUlNNTFJlbmRlckNvbmZpZ1V0aWxpdHkuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQ2FudmFzIGZyb20gXCIuLi8uLi8uLi9DYW52YXMvQ2FudmFzXCI7XG5pbXBvcnQgSVJlbmRlckJ1ZmZlckJpbmRpbmdDb25maWcgZnJvbSBcIi4vSVJlbmRlckJ1ZmZlckJpbmRpbmdDb25maWdcIjtcbmltcG9ydCBJQ29sb3JCdWZmZXJCaW5kaW5nQ29uZmlnIGZyb20gXCIuL0lDb2xvckJ1ZmZlckJpbmRpbmdDb25maWdcIjtcbmltcG9ydCBWZWN0b3I0IGZyb20gXCIuLi8uLi8uLi8uLi9NYXRoL1ZlY3RvcjRcIjtcbmltcG9ydCBJRkJPQmluZGluZ0NvbmZpZyBmcm9tIFwiLi9JRkJPQmluZGluZ0NvbmZpZ1wiO1xuY2xhc3MgUlNNTFJlbmRlckNvbmZpZ1V0aWxpdHkge1xuICBwdWJsaWMgc3RhdGljIHBhcnNlRkJPQ29uZmlndXJhdGlvbihmYm9FbGVtZW50OiBFbGVtZW50LCBjYW52YXM6IENhbnZhcyk6IElGQk9CaW5kaW5nQ29uZmlnIHtcbiAgICBpZiAoIWZib0VsZW1lbnQpIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGNvbnN0IHJlc3VsdCA9IDxJRkJPQmluZGluZ0NvbmZpZz57fTtcbiAgICBjb25zdCBwcmltYXJ5ID0gZmJvRWxlbWVudC5nZXRBdHRyaWJ1dGUoXCJwcmltYXJ5XCIpO1xuICAgIGNvbnN0IGNvbG9yTm9kZXMgPSBmYm9FbGVtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiY29sb3JcIik7XG4gICAgY29uc3QgcmJvTm9kZSA9IGZib0VsZW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJyYm9cIikuaXRlbSgwKTtcbiAgICByZXN1bHQucHJpbWFyeU5hbWUgPSBwcmltYXJ5O1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29sb3JOb2Rlcy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgY29sb3JCdWZmZXIgPSBSU01MUmVuZGVyQ29uZmlnVXRpbGl0eS5fcGFyc2VDb2xvckJ1ZmZlcihjb2xvck5vZGVzLml0ZW0oaSksIGNhbnZhcyk7XG4gICAgICByZXN1bHRbY29sb3JCdWZmZXIucmVnaXN0ZXJJbmRleF0gPSBjb2xvckJ1ZmZlcjtcbiAgICAgIGlmIChjb2xvckJ1ZmZlci5uYW1lID09PSBwcmltYXJ5KSB7XG4gICAgICAgIHJlc3VsdC5wcmltYXJ5SW5kZXggPSBjb2xvckJ1ZmZlci5yZWdpc3RlckluZGV4O1xuICAgICAgfVxuICAgIH1cbiAgICByZXN1bHQucmJvID0gUlNNTFJlbmRlckNvbmZpZ1V0aWxpdHkuX3BhcnNlUmVuZGVyQnVmZmVyKHJib05vZGUpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBwcml2YXRlIHN0YXRpYyBfcGFyc2VDb2xvckJ1ZmZlcihjb2xvckVsZW1lbnQ6IEVsZW1lbnQsIGNhbnZhczogQ2FudmFzKTogSUNvbG9yQnVmZmVyQmluZGluZ0NvbmZpZyB7XG4gICAgLy8gUmV0cml2ZSBidWZmZXIgbmFtZSB0byBiZSBib3VuZFxuICAgIGNvbnN0IG5hbWUgPSBjb2xvckVsZW1lbnQuZ2V0QXR0cmlidXRlKFwibmFtZVwiKTtcbiAgICBpZiAoIW5hbWUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJUaGUgbmFtZSBhdHRyaWJ1dGUgaW4gY29sb3Igbm9kZSBtdXN0IGJlIHNwZWNpZmllZCFcIik7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgLy8gUmV0cml2ZSByZWdpc3RlciBpbmRleFxuICAgIGNvbnN0IHJlZ2lzdGVyU3RyID0gY29sb3JFbGVtZW50LmdldEF0dHJpYnV0ZShcInJlZ2lzdGVyXCIpO1xuICAgIGxldCByZWdpc3RlckluZGV4ID0gMDtcbiAgICBpZiAocmVnaXN0ZXJTdHIpIHtcbiAgICAgIHJlZ2lzdGVySW5kZXggPSBwYXJzZUludChyZWdpc3RlclN0ciwgMTApO1xuICAgIH1cblxuICAgIC8vIFJldHJpdmUgY2xlYXIgZmxhZ1xuICAgIGNvbnN0IGNsZWFyU3RyID0gY29sb3JFbGVtZW50LmdldEF0dHJpYnV0ZShcImNsZWFyXCIpO1xuICAgIGNvbnN0IGNsZWFyRmxhZyA9IGNsZWFyU3RyICE9PSBcImZhbHNlXCI7XG5cbiAgICAvLyBSZXRyaXZlIGNsZWFyIGNvbG9yXG4gICAgbGV0IGNsZWFyQ29sb3I6IFZlY3RvcjQ7XG4gICAgaWYgKGNsZWFyRmxhZykge1xuICAgICAgY29uc3QgY29sb3JTdHIgPSBjb2xvckVsZW1lbnQuZ2V0QXR0cmlidXRlKFwiY2xlYXJDb2xvclwiKTtcbiAgICAgIGNsZWFyQ29sb3IgPSBuZXcgVmVjdG9yNCgwLCAwLCAwLCAwKTtcbiAgICAgIGlmIChjb2xvclN0cikge1xuICAgICAgICBpZiAoY29sb3JTdHIgPT09IFwiZGVmYXVsdFwiKSB7XG4gICAgICAgICBjbGVhckNvbG9yID0gY2FudmFzLmNsZWFyQ29sb3IudG9WZWN0b3IoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjbGVhckNvbG9yID0gVmVjdG9yNC5wYXJzZShjb2xvclN0cik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IG5hbWUsXG4gICAgICByZWdpc3RlckluZGV4OiByZWdpc3RlckluZGV4LFxuICAgICAgY2xlYXJDb2xvcjogY2xlYXJDb2xvcixcbiAgICAgIG5lZWRDbGVhcjogY2xlYXJGbGFnXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgc3RhdGljIF9wYXJzZVJlbmRlckJ1ZmZlcihyYm9FbGVtZW50OiBFbGVtZW50KTogSVJlbmRlckJ1ZmZlckJpbmRpbmdDb25maWcge1xuICAgIGlmICghcmJvRWxlbWVudCkge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gICAgLy8gUmV0cml2ZSBidWZmZXIgbmFtZSB0byBiZSBib3VuZFxuICAgIGxldCBuYW1lID0gcmJvRWxlbWVudC5nZXRBdHRyaWJ1dGUoXCJuYW1lXCIpO1xuICAgIGlmICghbmFtZSkge1xuICAgICAgbmFtZSA9IFwiZGVmYXVsdFwiO1xuICAgIH1cbiAgICBsZXQgdHlwZSA9IHJib0VsZW1lbnQuZ2V0QXR0cmlidXRlKFwidHlwZVwiKTtcbiAgICBpZiAoIXR5cGUpIHtcbiAgICAgIHR5cGUgPSBcImRlcHRoXCI7XG4gICAgfVxuICAgIGxldCBjbGVhclN0ciA9IHJib0VsZW1lbnQuZ2V0QXR0cmlidXRlKFwiY2xlYXJcIik7XG4gICAgY29uc3QgY2xlYXJGbGFnID0gY2xlYXJTdHIgIT09IFwiZmFsc2VcIjtcblxuICAgIGxldCBjbGVhckRlcHRoOiBudW1iZXI7XG4gICAgaWYgKGNsZWFyRmxhZykge1xuICAgICAgY29uc3QgZGVwdGhTdHIgPSByYm9FbGVtZW50LmdldEF0dHJpYnV0ZShcImNsZWFyRGVwdGhcIik7XG4gICAgICBjbGVhckRlcHRoID0gMS4wO1xuICAgICAgaWYgKGRlcHRoU3RyKSB7XG4gICAgICAgIGNsZWFyRGVwdGggPSBwYXJzZUZsb2F0KGRlcHRoU3RyKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IG5hbWUsXG4gICAgICB0eXBlOiB0eXBlLFxuICAgICAgbmVlZENsZWFyOiBjbGVhckZsYWcsXG4gICAgICBjbGVhckRlcHRoOiBjbGVhckRlcHRoXG4gICAgfTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBSU01MUmVuZGVyQ29uZmlnVXRpbGl0eTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==

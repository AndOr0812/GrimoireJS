import MatrixBase from "./MatrixBase";
import Vector3 from "./Vector3";
import Vector4 from "./Vector4";
import { mat4, vec3, vec4, quat } from "gl-matrix";
class Matrix extends MatrixBase {
    constructor(arr) {
        super();
        if (arr) {
            this.rawElements = arr;
        }
        else {
            this.rawElements = mat4.create();
        }
    }
    static zero() {
        return new Matrix([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]);
    }
    static identity() {
        return new Matrix(mat4.create());
    }
    static fromElements(m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {
        return new Matrix([m00, m10, m20, m30, m01, m11, m21, m31, m02, m12, m22, m32, m03, m13, m23, m33]);
    }
    static fromFunc(f) {
        return new Matrix([f(0, 0), f(1, 0), f(2, 0), f(3, 0), f(0, 1), f(1, 1), f(2, 1), f(3, 1), f(0, 2), f(1, 2), f(2, 2), f(3, 2), f(0, 3), f(1, 3), f(2, 3), f(3, 3)]);
    }
    static equals(m1, m2) {
        return Matrix.__elementEquals(m1, m2);
    }
    static add(m1, m2) {
        const mat = mat4.create();
        for (let i = 0; i < 16; i++) {
            mat[i] = m1.rawElements[i] + m2.rawElements[i];
        }
        return new Matrix(mat);
    }
    static subtract(m1, m2) {
        return Matrix.add(m1, Matrix.negate(m2));
    }
    static scalarMultiply(s, m) {
        const newMat = mat4.create();
        mat4.multiply(newMat, [s, 0, 0, 0, 0, s, 0, 0, 0, 0, s, 0, 0, 0, 0, s], m.rawElements);
        return new Matrix(newMat);
    }
    static multiply(m1, m2) {
        const newMat = mat4.create();
        return new Matrix(mat4.mul(newMat, m1.rawElements, m2.rawElements));
    }
    static trs(t, rot, s) {
        const newMat = mat4.create();
        const cacheMat = mat4.create();
        mat4.mul(newMat, mat4.translate(newMat, mat4.create(), t.rawElements), mat4.fromQuat(cacheMat, rot.rawElements));
        mat4.scale(newMat, newMat, s.rawElements);
        return new Matrix(newMat);
    }
    static negate(m) {
        return this.scalarMultiply(-1, m);
    }
    static transpose(m) {
        const newMat = mat4.create();
        return new Matrix(mat4.transpose(newMat, m.rawElements));
    }
    static transformPoint(m, t) {
        const newVec = vec3.create();
        vec3.transformMat4(newVec, t.rawElements, m.rawElements);
        return new Vector3(newVec);
    }
    static transformNormal(m, t) {
        const newVec = vec4.create();
        const trans = vec4.create();
        trans[0] = t.X;
        trans[1] = t.Y;
        trans[2] = t.Z;
        trans[3] = 0;
        vec4.transformMat4(newVec, trans, m.rawElements);
        return new Vector3(newVec[0], newVec[1], newVec[2]);
    }
    static transform(m, t) {
        const newVec = vec4.create();
        const trans = vec4.create();
        trans[0] = t.X;
        trans[1] = t.Y;
        trans[2] = t.Z;
        trans[3] = t.W;
        vec4.transformMat4(newVec, trans, m.rawElements);
        return new Vector4(newVec[0], newVec[1], newVec[2], newVec[3]);
    }
    /**
     * Retrieve determinant of passed matrix
     */
    static determinant(m) {
        return mat4.determinant(m.rawElements);
    }
    /**
     * Compute inverted passed matrix.
     */
    static inverse(m) {
        const newMat = mat4.create();
        return new Matrix(mat4.invert(newMat, m.rawElements));
    }
    /**
     * Generate linear translation transform matrix.
     */
    static translate(v) {
        const newMat = mat4.create();
        mat4.translate(newMat, newMat, v.rawElements);
        return new Matrix(newMat);
    }
    /**
     * Generate linear scaling transform matrix.
     */
    static scale(v) {
        const newMat = mat4.create();
        mat4.scale(newMat, newMat, v.rawElements);
        return new Matrix(newMat);
    }
    static rotateX(angle) {
        const newMat = mat4.create();
        mat4.rotateX(newMat, newMat, angle);
        return new Matrix(newMat);
    }
    static rotateY(angle) {
        const newMat = mat4.create();
        mat4.rotateY(newMat, newMat, angle);
        return new Matrix(newMat);
    }
    static rotateZ(angle) {
        const newMat = mat4.create();
        mat4.rotateZ(newMat, newMat, angle);
        return new Matrix(newMat);
    }
    static rotationQuaternion(quat_) {
        const quaternion = quat.create();
        const newMat = mat4.create();
        quat.normalize(quaternion, quat_.rawElements);
        mat4.fromQuat(newMat, quaternion);
        return new Matrix(newMat);
    }
    static frustum(left, right, bottom, top, near, far) {
        const newMat = mat4.create();
        mat4.frustum(newMat, left, right, bottom, top, near, far);
        return new Matrix(newMat);
    }
    static ortho(left, right, bottom, top, near, far) {
        const newMat = mat4.create();
        mat4.ortho(newMat, left, right, bottom, top, near, far);
        return new Matrix(newMat);
    }
    static perspective(fovy, aspect, near, far) {
        const newMat = mat4.create();
        mat4.perspective(newMat, fovy, aspect, near, far);
        return new Matrix(newMat);
    }
    static lookAt(eye, lookAt, up) {
        const newMat = mat4.create();
        mat4.lookAt(newMat, eye.rawElements, lookAt.rawElements, up.rawElements);
        return new Matrix(newMat);
    }
    getAt(row, colmun) {
        return this.rawElements[colmun * 4 + row];
    }
    setAt(row, colmun, val) {
        this.rawElements[colmun * 4 + row] = val;
    }
    getBySingleIndex(index) {
        return this.rawElements[index];
    }
    getColmun(col) {
        return new Vector4(this.rawElements[col * 4], this.rawElements[col * 4 + 1], this.rawElements[col * 4 + 2], this.rawElements[col * 4 + 3]);
    }
    /**
    * Get row
    * @params row [0-3]
    */
    getRow(row) {
        return new Vector4(this.rawElements[row], this.rawElements[row + 4], this.rawElements[row + 8], this.rawElements[row + 12]);
    }
    multiplyWith(m) {
        return Matrix.multiply(this, m);
    }
    equalWith(m) {
        return Matrix.equals(m, this);
    }
    toString() {
        return (`|${this.getBySingleIndex(0)} ${this.getBySingleIndex(4)} ${this.getBySingleIndex(8)} ${this.getBySingleIndex(12)}|\n
                 |${this.getBySingleIndex(1)} ${this.getBySingleIndex(5)} ${this.getBySingleIndex(9)} ${this.getBySingleIndex(13)}|\n
                 |${this.getBySingleIndex(2)} ${this.getBySingleIndex(6)} ${this.getBySingleIndex(10)} ${this.getBySingleIndex(14)}|\n
                 |${this.getBySingleIndex(3)} ${this.getBySingleIndex(7)} ${this.getBySingleIndex(11)} ${this.getBySingleIndex(15)}|`);
    }
    toMathematicaString() {
        return (`{{${this.getBySingleIndex(0)},${this.getBySingleIndex(4)},${this.getBySingleIndex(8)},${this.getBySingleIndex(12)}},
                  {${this.getBySingleIndex(1)},${this.getBySingleIndex(5)},${this.getBySingleIndex(9)},${this.getBySingleIndex(13)}},
                  {${this.getBySingleIndex(2)},${this.getBySingleIndex(6)},${this.getBySingleIndex(10)},${this.getBySingleIndex(14)}},
                  {${this.getBySingleIndex(3)},${this.getBySingleIndex(7)},${this.getBySingleIndex(11)},${this.getBySingleIndex(15)}}}`);
    }
    get ElementCount() { return 16; }
    get RowCount() { return 4; }
    get ColmunCount() { return 4; }
}
export default Matrix;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk1hdGgvTWF0cml4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJPQUNPLFVBQVUsTUFBTSxjQUFjO09BQzlCLE9BQU8sTUFBTSxXQUFXO09BQ3hCLE9BQU8sTUFBTSxXQUFXO09BR3hCLEVBQU0sSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFDLE1BQU0sV0FBVztBQUNyRCxxQkFBcUIsVUFBVTtJQUU3QixZQUFZLEdBQWdCO1FBQzFCLE9BQU8sQ0FBQztRQUNSLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDUixJQUFJLENBQUMsV0FBVyxHQUFHLEdBQUcsQ0FBQztRQUN6QixDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDTixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUNuQyxDQUFDO0lBQ0gsQ0FBQztJQUVELE9BQWMsSUFBSTtRQUNoQixNQUFNLENBQUMsSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3RFLENBQUM7SUFFRCxPQUFjLFFBQVE7UUFDcEIsTUFBTSxDQUFDLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO0lBQ25DLENBQUM7SUFFRCxPQUFjLFlBQVksQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHO1FBQ3ZHLE1BQU0sQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDdEcsQ0FBQztJQUVELE9BQWMsUUFBUSxDQUFDLENBQWdDO1FBQ3JELE1BQU0sQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3RLLENBQUM7SUFFRCxPQUFjLE1BQU0sQ0FBQyxFQUFVLEVBQUUs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Q0FBQyxDQUFDO0lBRWhELElBQVcsUUFBUSxLQUFhLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRTNDLElBQVcsV0FBVyxLQUFhLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBRWhELENBQUM7QUFDRCxlQUFlLE1BQU0sQ0FBQyIsImZpbGUiOiJNYXRoL01hdHJpeC5qcyIsInNvdXJjZXNDb250ZW50IjpbIlxuaW1wb3J0IE1hdHJpeEJhc2UgZnJvbSBcIi4vTWF0cml4QmFzZVwiO1xuaW1wb3J0IFZlY3RvcjMgZnJvbSBcIi4vVmVjdG9yM1wiO1xuaW1wb3J0IFZlY3RvcjQgZnJvbSBcIi4vVmVjdG9yNFwiO1xuaW1wb3J0IHtGdW5jMn0gZnJvbSBcIi4uL0Jhc2UvRGVsZWdhdGVzXCI7XG5pbXBvcnQgUXVhdGVybmlvbiBmcm9tIFwiLi9RdWF0ZXJuaW9uXCI7XG5pbXBvcnQge0dMTSwgbWF0NCwgdmVjMywgdmVjNCwgcXVhdH0gZnJvbSBcImdsLW1hdHJpeFwiO1xuY2xhc3MgTWF0cml4IGV4dGVuZHMgTWF0cml4QmFzZSB7XG5cbiAgY29uc3RydWN0b3IoYXJyPzogR0xNLklBcnJheSkge1xuICAgIHN1cGVyKCk7XG4gICAgaWYgKGFycikge1xuICAgICAgdGhpcy5yYXdFbGVtZW50cyA9IGFycjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5yYXdFbGVtZW50cyA9IG1hdDQuY3JlYXRlKCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHN0YXRpYyB6ZXJvKCk6IE1hdHJpeCB7XG4gICAgcmV0dXJuIG5ldyBNYXRyaXgoWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdKTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgaWRlbnRpdHkoKTogTWF0cml4IHtcbiAgICByZXR1cm4gbmV3IE1hdHJpeChtYXQ0LmNyZWF0ZSgpKTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgZnJvbUVsZW1lbnRzKG0wMCwgbTAxLCBtMDIsIG0wMywgbTEwLCBtMTEsIG0xMiwgbTEzLCBtMjAsIG0yMSwgbTIyLCBtMjMsIG0zMCwgbTMxLCBtMzIsIG0zMyk6IE1hdHJpeCB7XG4gICAgcmV0dXJuIG5ldyBNYXRyaXgoW20wMCwgbTEwLCBtMjAsIG0zMCwgbTAxLCBtMTEsIG0yMSwgbTMxLCBtMDIsIG0xMiwgbTIyLCBtMzIsIG0wMywgbTEzLCBtMjMsIG0zM10pO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyBmcm9tRnVuYyhmOiBGdW5jMjxudW1iZXIsIG51bWJlciwgbnVtYmVyPik6IE1hdHJpeCB7XG4gICAgcmV0dXJuIG5ldyBNYXRyaXgoW2YoMCwgMCksIGYoMSwgMCksIGYoMiwgMCksIGYoMywgMCksIGYoMCwgMSksIGYoMSwgMSksIGYoMiwgMSksIGYoMywgMSksIGYoMCwgMiksIGYoMSwgMiksIGYoMiwgMiksIGYoMywgMiksIGYoMCwgMyksIGYoMSwgMyksIGYoMiwgMyksIGYoMywgMyldKTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgZXF1YWxzKG0xOiBNYXRyaXgsIG0yOiBNYXRyaXgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gTWF0cml4Ll9fZWxlbWVudEVxdWFscyhtMSwgbTIpO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyBhZGQobTE6IE1hdHJpeCwgbTI6IE1hdHJpeCk6IE1hdHJpeCB7XG4gICAgY29uc3QgbWF0ID0gbWF0NC5jcmVhdGUoKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDE2OyBpKyspIHtcbiAgICAgIG1hdFtpXSA9IG0xLnJhd0VsZW1lbnRzW2ldICsgbTIucmF3RWxlbWVudHNbaV07XG4gICAgfVxuICAgIHJldHVybiBuZXcgTWF0cml4KG1hdCk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIHN1YnRyYWN0KG0xOiBNYXRyaXgsIG0yOiBNYXRyaXgpOiBNYXRyaXgge1xuICAgIHJldHVybiBNYXRyaXguYWRkKG0xLCBNYXRyaXgubmVnYXRlKG0yKSk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIHNjYWxhck11bHRpcGx5KHM6IG51bWJlciwgbTogTWF0cml4KTogTWF0cml4IHtcbiAgICBjb25zdCBuZXdNYXQgPSBtYXQ0LmNyZWF0ZSgpO1xuICAgIG1hdDQubXVsdGlwbHkobmV3TWF0LCBbcywgMCwgMCwgMCwgMCwgcywgMCwgMCwgMCwgMCwgcywgMCwgMCwgMCwgMCwgc10sIG0ucmF3RWxlbWVudHMpO1xuICAgIHJldHVybiBuZXcgTWF0cml4KG5ld01hdCk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIG11bHRpcGx5KG0xOiBNYXRyaXgsIG0yOiBNYXRyaXgpOiBNYXRyaXgge1xuICAgIGNvbnN0IG5ld01hdCA9IG1hdDQuY3JlYXRlKCk7XG4gICAgcmV0dXJuIG5ldyBNYXRyaXgobWF0NC5tdWwobmV3TWF0LCBtMS5yYXdFbGVtZW50cywgbTIucmF3RWxlbWVudHMpKTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgdHJzKHQ6IFZlY3RvcjMsIHJvdDogUXVhdGVybmlvbiwgczogVmVjdG9yMyk6IE1hdHJpeCB7XG4gICAgY29uc3QgbmV3TWF0ID0gbWF0NC5jcmVhdGUoKTsgY29uc3QgY2FjaGVNYXQgPSBtYXQ0LmNyZWF0ZSgpO1xuICAgIG1hdDQubXVsKG5ld01hdCwgbWF0NC50cmFuc2xhdGUobmV3TWF0LCBtYXQ0LmNyZWF0ZSgpLCB0LnJhd0VsZW1lbnRzKSwgbWF0NC5mcm9tUXVhdChjYWNoZU1hdCwgcm90LnJhd0VsZW1lbnRzKSk7XG4gICAgbWF0NC5zY2FsZShuZXdNYXQsIG5ld01hdCwgcy5yYXdFbGVtZW50cyk7XG4gICAgcmV0dXJuIG5ldyBNYXRyaXgobmV3TWF0KTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgbmVnYXRlKG06IE1hdHJpeCk6IE1hdHJpeCB7XG4gICAgcmV0dXJuIHRoaXMuc2NhbGFyTXVsdGlwbHkoLTEsIG0pO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyB0cmFuc3Bvc2UobTogTWF0cml4KTogTWF0cml4IHtcbiAgICBjb25zdCBuZXdNYXQgPSBtYXQ0LmNyZWF0ZSgpO1xuICAgIHJldHVybiBuZXcgTWF0cml4KG1hdDQudHJhbnNwb3NlKG5ld01hdCwgbS5yYXdFbGVtZW50cykpO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyB0cmFuc2Zvcm1Qb2ludChtOiBNYXRyaXgsIHQ6IFZlY3RvcjMpOiBWZWN0b3IzIHtcbiAgICBjb25zdCBuZXdWZWMgPSB2ZWMzLmNyZWF0ZSgpO1xuICAgIHZlYzMudHJhbnNmb3JtTWF0NChuZXdWZWMsIHQucmF3RWxlbWVudHMsIG0ucmF3RWxlbWVudHMpO1xuICAgIHJldHVybiBuZXcgVmVjdG9yMyhuZXdWZWMpO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyB0cmFuc2Zvcm1Ob3JtYWwobTogTWF0cml4LCB0OiBWZWN0b3IzKTogVmVjdG9yMyB7XG4gICAgY29uc3QgbmV3VmVjID0gdmVjNC5jcmVhdGUoKTtcbiAgICBjb25zdCB0cmFucyA9IHZlYzQuY3JlYXRlKCk7XG4gICAgdHJhbnNbMF0gPSB0Llg7IHRyYW5zWzFdID0gdC5ZOyB0cmFuc1syXSA9IHQuWjsgdHJhbnNbM10gPSAwO1xuICAgIHZlYzQudHJhbnNmb3JtTWF0NChuZXdWZWMsIHRyYW5zLCBtLnJhd0VsZW1lbnRzKTtcbiAgICByZXR1cm4gbmV3IFZlY3RvcjMobmV3VmVjWzBdLCBuZXdWZWNbMV0sIG5ld1ZlY1syXSk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIHRyYW5zZm9ybShtOiBNYXRyaXgsIHQ6IFZlY3RvcjQpOiBWZWN0b3I0IHtcbiAgICBjb25zdCBuZXdWZWMgPSB2ZWM0LmNyZWF0ZSgpO1xuICAgIGNvbnN0IHRyYW5zID0gdmVjNC5jcmVhdGUoKTtcbiAgICB0cmFuc1swXSA9IHQuWDsgdHJhbnNbMV0gPSB0Llk7IHRyYW5zWzJdID0gdC5aOyB0cmFuc1szXSA9IHQuVztcbiAgICB2ZWM0LnRyYW5zZm9ybU1hdDQobmV3VmVjLCB0cmFucywgbS5yYXdFbGVtZW50cyk7XG4gICAgcmV0dXJuIG5ldyBWZWN0b3I0KG5ld1ZlY1swXSwgbmV3VmVjWzFdLCBuZXdWZWNbMl0sIG5ld1ZlY1szXSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmUgZGV0ZXJtaW5hbnQgb2YgcGFzc2VkIG1hdHJpeFxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBkZXRlcm1pbmFudChtOiBNYXRyaXgpOiBudW1iZXIge1xuICAgIHJldHVybiBtYXQ0LmRldGVybWluYW50KG0ucmF3RWxlbWVudHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbXB1dGUgaW52ZXJ0ZWQgcGFzc2VkIG1hdHJpeC5cbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgaW52ZXJzZShtOiBNYXRyaXgpOiBNYXRyaXgge1xuICAgIGNvbnN0IG5ld01hdCA9IG1hdDQuY3JlYXRlKCk7XG4gICAgcmV0dXJuIG5ldyBNYXRyaXgobWF0NC5pbnZlcnQobmV3TWF0LCBtLnJhd0VsZW1lbnRzKSk7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgbGluZWFyIHRyYW5zbGF0aW9uIHRyYW5zZm9ybSBtYXRyaXguXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIHRyYW5zbGF0ZSh2OiBWZWN0b3IzKTogTWF0cml4IHtcbiAgICBjb25zdCBuZXdNYXQgPSBtYXQ0LmNyZWF0ZSgpO1xuICAgIG1hdDQudHJhbnNsYXRlKG5ld01hdCwgbmV3TWF0LCB2LnJhd0VsZW1lbnRzKTtcbiAgICByZXR1cm4gbmV3IE1hdHJpeChuZXdNYXQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIGxpbmVhciBzY2FsaW5nIHRyYW5zZm9ybSBtYXRyaXguXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIHNjYWxlKHY6IFZlY3RvcjMpOiBNYXRyaXgge1xuICAgIGNvbnN0IG5ld01hdCA9IG1hdDQuY3JlYXRlKCk7XG4gICAgbWF0NC5zY2FsZShuZXdNYXQsIG5ld01hdCwgdi5yYXdFbGVtZW50cyk7XG4gICAgcmV0dXJuIG5ldyBNYXRyaXgobmV3TWF0KTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgcm90YXRlWChhbmdsZTogbnVtYmVyKTogTWF0cml4IHtcbiAgICBjb25zdCBuZXdNYXQgPSBtYXQ0LmNyZWF0ZSgpO1xuICAgIG1hdDQucm90YXRlWChuZXdNYXQsIG5ld01hdCwgYW5nbGUpO1xuICAgIHJldHVybiBuZXcgTWF0cml4KG5ld01hdCk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIHJvdGF0ZVkoYW5nbGU6IG51bWJlcik6IE1hdHJpeCB7XG4gICAgY29uc3QgbmV3TWF0ID0gbWF0NC5jcmVhdGUoKTtcbiAgICBtYXQ0LnJvdGF0ZVkobmV3TWF0LCBuZXdNYXQsIGFuZ2xlKTtcbiAgICByZXR1cm4gbmV3IE1hdHJpeChuZXdNYXQpO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyByb3RhdGVaKGFuZ2xlOiBudW1iZXIpOiBNYXRyaXgge1xuICAgIGNvbnN0IG5ld01hdCA9IG1hdDQuY3JlYXRlKCk7XG4gICAgbWF0NC5yb3RhdGVaKG5ld01hdCwgbmV3TWF0LCBhbmdsZSk7XG4gICAgcmV0dXJuIG5ldyBNYXRyaXgobmV3TWF0KTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgcm90YXRpb25RdWF0ZXJuaW9uKHF1YXRfOiBRdWF0ZXJuaW9uKTogTWF0cml4IHtcbiAgICBjb25zdCBxdWF0ZXJuaW9uID0gcXVhdC5jcmVhdGUoKTtcbiAgICBjb25zdCBuZXdNYXQgPSBtYXQ0LmNyZWF0ZSgpO1xuICAgIHF1YXQubm9ybWFsaXplKHF1YXRlcm5pb24sIHF1YXRfLnJhd0VsZW1lbnRzKTtcbiAgICBtYXQ0LmZyb21RdWF0KG5ld01hdCwgcXVhdGVybmlvbik7XG4gICAgcmV0dXJuIG5ldyBNYXRyaXgobmV3TWF0KTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgZnJ1c3R1bShsZWZ0OiBudW1iZXIsIHJpZ2h0OiBudW1iZXIsIGJvdHRvbTogbnVtYmVyLCB0b3A6IG51bWJlciwgbmVhcjogbnVtYmVyLCBmYXI6IG51bWJlcik6IE1hdHJpeCB7XG4gICAgY29uc3QgbmV3TWF0ID0gbWF0NC5jcmVhdGUoKTtcbiAgICBtYXQ0LmZydXN0dW0obmV3TWF0LCBsZWZ0LCByaWdodCwgYm90dG9tLCB0b3AsIG5lYXIsIGZhcik7XG4gICAgcmV0dXJuIG5ldyBNYXRyaXgobmV3TWF0KTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgb3J0aG8obGVmdDogbnVtYmVyLCByaWdodDogbnVtYmVyLCBib3R0b206IG51bWJlciwgdG9wOiBudW1iZXIsIG5lYXI6IG51bWJlciwgZmFyOiBudW1iZXIpOiBNYXRyaXgge1xuICAgIGNvbnN0IG5ld01hdCA9IG1hdDQuY3JlYXRlKCk7XG4gICAgbWF0NC5vcnRobyhuZXdNYXQsIGxlZnQsIHJpZ2h0LCBib3R0b20sIHRvcCwgbmVhciwgZmFyKTtcbiAgICByZXR1cm4gbmV3IE1hdHJpeChuZXdNYXQpO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyBwZXJzcGVjdGl2ZShmb3Z5OiBudW1iZXIsIGFzcGVjdDogbnVtYmVyLCBuZWFyOiBudW1iZXIsIGZhcjogbnVtYmVyKTogTWF0cml4IHtcbiAgICBjb25zdCBuZXdNYXQgPSBtYXQ0LmNyZWF0ZSgpO1xuICAgIG1hdDQucGVyc3BlY3RpdmUobmV3TWF0LCBmb3Z5LCBhc3BlY3QsIG5lYXIsIGZhcik7XG4gICAgcmV0dXJuIG5ldyBNYXRyaXgobmV3TWF0KTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgbG9va0F0KGV5ZTogVmVjdG9yMywgbG9va0F0OiBWZWN0b3IzLCB1cDogVmVjdG9yMyk6IE1hdHJpeCB7XG4gICAgY29uc3QgbmV3TWF0ID0gbWF0NC5jcmVhdGUoKTtcbiAgICBtYXQ0Lmxvb2tBdChuZXdNYXQsIGV5ZS5yYXdFbGVtZW50cywgbG9va0F0LnJhd0VsZW1lbnRzLCB1cC5yYXdFbGVtZW50cyk7XG4gICAgcmV0dXJuIG5ldyBNYXRyaXgobmV3TWF0KTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRBdChyb3c6IG51bWJlciwgY29sbXVuOiBudW1iZXIpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLnJhd0VsZW1lbnRzW2NvbG11biAqIDQgKyByb3ddO1xuICB9XG5cbiAgcHVibGljIHNldEF0KHJvdzogbnVtYmVyLCBjb2xtdW46IG51bWJlciwgdmFsOiBudW1iZXIpOiB2b2lkIHtcbiAgICB0aGlzLnJhd0VsZW1lbnRzW2NvbG11biAqIDQgKyByb3ddID0gdmFsO1xuICB9XG5cbiAgcHVibGljIGdldEJ5U2luZ2xlSW5kZXgoaW5kZXg6IG51bWJlcik6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMucmF3RWxlbWVudHNbaW5kZXhdO1xuICB9XG5cbiAgcHVibGljIGdldENvbG11bihjb2w6IG51bWJlcik6IFZlY3RvcjQge1xuICAgIHJldHVybiBuZXcgVmVjdG9yNCh0aGlzLnJhd0VsZW1lbnRzW2NvbCAqIDRdLCB0aGlzLnJhd0VsZW1lbnRzW2NvbCAqIDQgKyAxXSwgdGhpcy5yYXdFbGVtZW50c1tjb2wgKiA0ICsgMl0sIHRoaXMucmF3RWxlbWVudHNbY29sICogNCArIDNdKTtcbiAgfVxuXG4gIC8qKlxuICAqIEdldCByb3dcbiAgKiBAcGFyYW1zIHJvdyBbMC0zXVxuICAqL1xuICBwdWJsaWMgZ2V0Um93KHJvdzogbnVtYmVyKTogVmVjdG9yNCB7XG4gICAgcmV0dXJuIG5ldyBWZWN0b3I0KHRoaXMucmF3RWxlbWVudHNbcm93XSwgdGhpcy5yYXdFbGVtZW50c1tyb3cgKyA0XSwgdGhpcy5yYXdFbGVtZW50c1tyb3cgKyA4XSwgdGhpcy5yYXdFbGVtZW50c1tyb3cgKyAxMl0pO1xuICB9XG5cbiAgcHVibGljIG11bHRpcGx5V2l0aChtOiBNYXRyaXgpOiBNYXRyaXgge1xuICAgIHJldHVybiBNYXRyaXgubXVsdGlwbHkodGhpcywgbSk7XG4gIH1cblxuICBwdWJsaWMgZXF1YWxXaXRoKG06IE1hdHJpeCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBNYXRyaXguZXF1YWxzKG0sIHRoaXMpO1xuICB9XG5cbiAgcHVibGljIHRvU3RyaW5nKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIChgfCR7dGhpcy5nZXRCeVNpbmdsZUluZGV4KDApIH0gJHt0aGlzLmdldEJ5U2luZ2xlSW5kZXgoNCkgfSAke3RoaXMuZ2V0QnlTaW5nbGVJbmRleCg4KSB9ICR7dGhpcy5nZXRCeVNpbmdsZUluZGV4KDEyKSB9fFxcblxuICAgICAgICAgICAgICAgICB8JHt0aGlzLmdldEJ5U2luZ2xlSW5kZXgoMSkgfSAke3RoaXMuZ2V0QnlTaW5nbGVJbmRleCg1KSB9ICR7dGhpcy5nZXRCeVNpbmdsZUluZGV4KDkpIH0gJHt0aGlzLmdldEJ5U2luZ2xlSW5kZXgoMTMpIH18XFxuXG4gICAgICAgICAgICAgICAgIHwke3RoaXMuZ2V0QnlTaW5nbGVJbmRleCgyKSB9ICR7dGhpcy5nZXRCeVNpbmdsZUluZGV4KDYpIH0gJHt0aGlzLmdldEJ5U2luZ2xlSW5kZXgoMTApIH0gJHt0aGlzLmdldEJ5U2luZ2xlSW5kZXgoMTQpIH18XFxuXG4gICAgICAgICAgICAgICAgIHwke3RoaXMuZ2V0QnlTaW5nbGVJbmRleCgzKSB9ICR7dGhpcy5nZXRCeVNpbmdsZUluZGV4KDcpIH0gJHt0aGlzLmdldEJ5U2luZ2xlSW5kZXgoMTEpIH0gJHt0aGlzLmdldEJ5U2luZ2xlSW5kZXgoMTUpIH18YCk7XG4gIH1cblxuICBwdWJsaWMgdG9NYXRoZW1hdGljYVN0cmluZygpOiBzdHJpbmcge1xuICAgIHJldHVybiAoYHt7JHt0aGlzLmdldEJ5U2luZ2xlSW5kZXgoMCkgfSwke3RoaXMuZ2V0QnlTaW5nbGVJbmRleCg0KSB9LCR7dGhpcy5nZXRCeVNpbmdsZUluZGV4KDgpIH0sJHt0aGlzLmdldEJ5U2luZ2xlSW5kZXgoMTIpIH19LFxuICAgICAgICAgICAgICAgICAgeyR7dGhpcy5nZXRCeVNpbmdsZUluZGV4KDEpIH0sJHt0aGlzLmdldEJ5U2luZ2xlSW5kZXgoNSkgfSwke3RoaXMuZ2V0QnlTaW5nbGVJbmRleCg5KSB9LCR7dGhpcy5nZXRCeVNpbmdsZUluZGV4KDEzKSB9fSxcbiAgICAgICAgICAgICAgICAgIHske3RoaXMuZ2V0QnlTaW5nbGVJbmRleCgyKSB9LCR7dGhpcy5nZXRCeVNpbmdsZUluZGV4KDYpIH0sJHt0aGlzLmdldEJ5U2luZ2xlSW5kZXgoMTApIH0sJHt0aGlzLmdldEJ5U2luZ2xlSW5kZXgoMTQpIH19LFxuICAgICAgICAgICAgICAgICAgeyR7dGhpcy5nZXRCeVNpbmdsZUluZGV4KDMpIH0sJHt0aGlzLmdldEJ5U2luZ2xlSW5kZXgoNykgfSwke3RoaXMuZ2V0QnlTaW5nbGVJbmRleCgxMSkgfSwke3RoaXMuZ2V0QnlTaW5nbGVJbmRleCgxNSkgfX19YCk7XG4gIH1cblxuICBwdWJsaWMgZ2V0IEVsZW1lbnRDb3VudCgpOiBudW1iZXIgeyByZXR1cm4gMTY7IH1cblxuICBwdWJsaWMgZ2V0IFJvd0NvdW50KCk6IG51bWJlciB7IHJldHVybiA0OyB9XG5cbiAgcHVibGljIGdldCBDb2xtdW5Db3VudCgpOiBudW1iZXIgeyByZXR1cm4gNDsgfVxuXG59XG5leHBvcnQgZGVmYXVsdCBNYXRyaXg7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=

import Vector4 from "./Vector4";
import Vector3 from "./Vector3";
import Vector2 from "./Vector2";
/**
 *  The array object for managing vectors having specific dimension.
 */
class VectorArray {
    constructor(length) {
        if (length) {
            this.rawElements = new Array(length);
        }
        else {
            this.rawElements = [];
        }
    }
    /**
     * Generate vector array filled with zero vectors.
     * @param  {number}      dimension [description]
     * @param  {number}      length   [description]
     * @return {VectorArray}          [description]
     */
    static zeroVectorArray(dimension, length) {
        const array = new VectorArray(dimension * length);
        for (let i = 0; i < dimension * length; i++) {
            array.rawElements[i] = 0;
        }
        array._dimension = dimension;
        return array;
    }
    static fromArray(dimension, source) {
        const array = new VectorArray(source.length);
        array._dimension = dimension;
        for (let i = 0; i < source.length; i++) {
            array.rawElements[i] = source[i];
        }
        return array;
    }
    static equals(v1, v2) {
        if (v1.rawElements.length !== v2.rawElements.length || v1._dimension !== v2._dimension) {
            return false;
        }
        for (let i = 0; i < v1.rawElements.length; i++) {
            if (v1.rawElements[i] !== v2.rawElements[i]) {
                return false;
            }
        }
        return true;
    }
    equalWith(v1) {
        return VectorArray.equals(this, v1);
    }
    appendVector(vector) {
        this._verifyDimension(vector);
        this.rawElements.push(vector.rawElements);
    }
    setVector(index, vector) {
        this._verifyDimension(vector);
        for (let elemIndex = 0; elemIndex < vector.ElementCount; elemIndex++) {
            this.rawElements[index * this._dimension + elemIndex] = vector.rawElements[elemIndex];
        }
        return;
    }
    setRawArray(index, rawArray) {
        for (let elemIndex = 0; elemIndex < this._dimension; elemIndex++) {
            this.rawElements[index * this._dimension + elemIndex] = rawArray[elemIndex] ? rawArray[elemIndex] : 0;
        }
        return;
    }
    getVector(index) {
        switch (this._dimension) {
            case 2:
                return new Vector2(this.rawElements[index * this._dimension + 0], this.rawElements[index * this._dimension + 1]);
            case 3:
                return new Vector3(this.rawElements[index * this._dimension + 0], this.rawElements[index * this._dimension + 1], this.rawElements[index * this._dimension + 2]);
            case 4:
                return new Vector4(this.rawElements[index * this._dimension + 0], this.rawElements[index * this._dimension + 1], this.rawElements[index * this._dimension + 2], this.rawElements[index * this._dimension + 3]);
            default:
                return null;
        }
    }
    setVectorArray(vectors, offset = 0) {
        if (vectors.length === 0) {
            return;
        }
        this._verifyDimension(vectors[0]);
        vectors.forEach((e, i) => {
            if (this._dimension !== e.ElementCount) {
                throw new Error(`Unmatch unit size of vector element! at:${i}`);
            }
            for (let elemIndex = 0; elemIndex < this._dimension; elemIndex++) {
                this.rawElements[offset + this._dimension * i + elemIndex] = e.rawElements[elemIndex];
            }
        });
        return;
    }
    getVectorArray() {
        if (this.rawElements.length === 0) {
            return [];
        }
        const result = new Array(this.rawElements.length / this._dimension);
        for (let i = 0; i < result.length; i++) {
            result[i] = this.getVector(i);
        }
        return result;
    }
    get dimension() {
        return this._dimension;
    }
    _verifyDimension(vector) {
        if (typeof this._dimension !== "undefined" && this._dimension !== vector.ElementCount) {
            throw new Error("Unmatch unit size of vectors!");
        }
        else if (typeof this._dimension === "undefined") {
            this._dimension = vector.ElementCount;
        }
    }
}
export default VectorArray;

//# sourceMappingURL=data:application/json;base64,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LENBQUM7UUFDbkQsQ0FBQztRQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxPQUFPLElBQUksQ0FBQyxVQUFVLEtBQUssV0FBVyxDQUFDLENBQUMsQ0FBQztZQUNsRCxJQUFJLENBQUMsVUFBVSxHQUFHLE1BQU0sQ0FBQyxZQUFZLENBQUM7UUFDeEMsQ0FBQztJQUNILENBQUM7QUFDSCxDQUFDO0FBRUQsZUFBZSxXQUFXLENBQUMiLCJmaWxlIjoiTWF0aC9WZWN0b3JBcnJheS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBWZWN0b3I0IGZyb20gXCIuL1ZlY3RvcjRcIjtcbmltcG9ydCBWZWN0b3IzIGZyb20gXCIuL1ZlY3RvcjNcIjtcbmltcG9ydCBWZWN0b3IyIGZyb20gXCIuL1ZlY3RvcjJcIjtcbmltcG9ydCBWZWN0b3JCYXNlIGZyb20gXCIuL1ZlY3RvckJhc2VcIjtcbi8qKlxuICogIFRoZSBhcnJheSBvYmplY3QgZm9yIG1hbmFnaW5nIHZlY3RvcnMgaGF2aW5nIHNwZWNpZmljIGRpbWVuc2lvbi5cbiAqL1xuY2xhc3MgVmVjdG9yQXJyYXkge1xuXG4gIHB1YmxpYyByYXdFbGVtZW50czogbnVtYmVyW107XG5cbiAgcHJpdmF0ZSBfZGltZW5zaW9uOiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIHZlY3RvciBhcnJheSBmaWxsZWQgd2l0aCB6ZXJvIHZlY3RvcnMuXG4gICAqIEBwYXJhbSAge251bWJlcn0gICAgICBkaW1lbnNpb24gW2Rlc2NyaXB0aW9uXVxuICAgKiBAcGFyYW0gIHtudW1iZXJ9ICAgICAgbGVuZ3RoICAgW2Rlc2NyaXB0aW9uXVxuICAgKiBAcmV0dXJuIHtWZWN0b3JBcnJheX0gICAgICAgICAgW2Rlc2NyaXB0aW9uXVxuICAgKi9cbiAgcHVibGljIHN0YXRpYyB6ZXJvVmVjdG9yQXJyYXkoZGltZW5zaW9uOiBudW1iZXIsIGxlbmd0aDogbnVtYmVyKTogVmVjdG9yQXJyYXkge1xuICAgIGNvbnN0IGFycmF5ID0gbmV3IFZlY3RvckFycmF5KGRpbWVuc2lvbiAqIGxlbmd0aCk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkaW1lbnNpb24gKiBsZW5ndGg7IGkrKykge1xuICAgICAgYXJyYXkucmF3RWxlbWVudHNbaV0gPSAwO1xuICAgIH1cbiAgICBhcnJheS5fZGltZW5zaW9uID0gZGltZW5zaW9uO1xuICAgIHJldHVybiBhcnJheTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgZnJvbUFycmF5KGRpbWVuc2lvbjogbnVtYmVyLCBzb3VyY2U6IG51bWJlcltdKTogVmVjdG9yQXJyYXkge1xuICAgIGNvbnN0IGFycmF5ID0gbmV3IFZlY3RvckFycmF5KHNvdXJjZS5sZW5ndGgpO1xuICAgIGFycmF5Ll9kaW1lbnNpb24gPSBkaW1lbnNpb247XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzb3VyY2UubGVuZ3RoOyBpKyspIHtcbiAgICAgIGFycmF5LnJhd0VsZW1lbnRzW2ldID0gc291cmNlW2ldO1xuICAgIH1cbiAgICByZXR1cm4gYXJyYXk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGVxdWFscyh2MTogVmVjdG9yQXJyYXksIHYyOiBWZWN0b3JBcnJheSk6IGJvb2xlYW4ge1xuICAgIGlmICh2MS5yYXdFbGVtZW50cy5sZW5ndGggIT09IHYyLnJhd0VsZW1lbnRzLmxlbmd0aCB8fCB2MS5fZGltZW5zaW9uICE9PSB2Mi5fZGltZW5zaW9uKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdjEucmF3RWxlbWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmICh2MS5yYXdFbGVtZW50c1tpXSAhPT0gdjIucmF3RWxlbWVudHNbaV0pIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKGxlbmd0aD86IG51bWJlcikge1xuICAgIGlmIChsZW5ndGgpIHtcbiAgICAgIHRoaXMucmF3RWxlbWVudHMgPSBuZXcgQXJyYXkobGVuZ3RoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5yYXdFbGVtZW50cyA9IFtdO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBlcXVhbFdpdGgodjE6IFZlY3RvckFycmF5KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIFZlY3RvckFycmF5LmVxdWFscyh0aGlzLCB2MSk7XG4gIH1cblxuICBwdWJsaWMgYXBwZW5kVmVjdG9yKHZlY3RvcjogVmVjdG9yQmFzZSk6IHZvaWQge1xuICAgIHRoaXMuX3ZlcmlmeURpbWVuc2lvbih2ZWN0b3IpO1xuICAgIHRoaXMucmF3RWxlbWVudHMucHVzaCg8YW55PnZlY3Rvci5yYXdFbGVtZW50cyk7XG4gIH1cblxuICBwdWJsaWMgc2V0VmVjdG9yKGluZGV4OiBudW1iZXIsIHZlY3RvcjogVmVjdG9yQmFzZSk6IHZvaWQge1xuICAgIHRoaXMuX3ZlcmlmeURpbWVuc2lvbih2ZWN0b3IpO1xuICAgIGZvciAobGV0IGVsZW1JbmRleCA9IDA7IGVsZW1JbmRleCA8IHZlY3Rvci5FbGVtZW50Q291bnQ7IGVsZW1JbmRleCsrKSB7XG4gICAgICB0aGlzLnJhd0VsZW1lbnRzW2luZGV4ICogdGhpcy5fZGltZW5zaW9uICsgZWxlbUluZGV4XSA9IHZlY3Rvci5yYXdFbGVtZW50c1tlbGVtSW5kZXhdO1xuICAgIH1cbiAgICByZXR1cm47XG4gIH1cblxuICBwdWJsaWMgc2V0UmF3QXJyYXkoaW5kZXg6IG51bWJlciwgcmF3QXJyYXk6IG51bWJlcltdKTogdm9pZCB7XG4gICAgZm9yIChsZXQgZWxlbUluZGV4ID0gMDsgZWxlbUluZGV4IDwgdGhpcy5fZGltZW5zaW9uOyBlbGVtSW5kZXgrKykge1xuICAgICAgdGhpcy5yYXdFbGVtZW50c1tpbmRleCAqIHRoaXMuX2RpbWVuc2lvbiArIGVsZW1JbmRleF0gPSByYXdBcnJheVtlbGVtSW5kZXhdID8gcmF3QXJyYXlbZWxlbUluZGV4XSA6IDA7XG4gICAgfVxuICAgIHJldHVybjtcbiAgfVxuXG4gIHB1YmxpYyBnZXRWZWN0b3I8VCBleHRlbmRzIFZlY3RvckJhc2U+KGluZGV4OiBudW1iZXIpOiBUIHtcbiAgICBzd2l0Y2ggKHRoaXMuX2RpbWVuc2lvbikge1xuICAgICAgY2FzZSAyOlxuICAgICAgICByZXR1cm4gPFQ+PGFueT5uZXcgVmVjdG9yMih0aGlzLnJhd0VsZW1lbnRzW2luZGV4ICogdGhpcy5fZGltZW5zaW9uICsgMF0sIHRoaXMucmF3RWxlbWVudHNbaW5kZXggKiB0aGlzLl9kaW1lbnNpb24gKyAxXSk7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIHJldHVybiA8VD48YW55Pm5ldyBWZWN0b3IzKHRoaXMucmF3RWxlbWVudHNbaW5kZXggKiB0aGlzLl9kaW1lbnNpb24gKyAwXSwgdGhpcy5yYXdFbGVtZW50c1tpbmRleCAqIHRoaXMuX2RpbWVuc2lvbiArIDFdLCB0aGlzLnJhd0VsZW1lbnRzW2luZGV4ICogdGhpcy5fZGltZW5zaW9uICsgMl0pO1xuICAgICAgY2FzZSA0OlxuICAgICAgICByZXR1cm4gPFQ+PGFueT5uZXcgVmVjdG9yNCh0aGlzLnJhd0VsZW1lbnRzW2luZGV4ICogdGhpcy5fZGltZW5zaW9uICsgMF0sIHRoaXMucmF3RWxlbWVudHNbaW5kZXggKiB0aGlzLl9kaW1lbnNpb24gKyAxXSwgdGhpcy5yYXdFbGVtZW50c1tpbmRleCAqIHRoaXMuX2RpbWVuc2lvbiArIDJdLCB0aGlzLnJhd0VsZW1lbnRzW2luZGV4ICogdGhpcy5fZGltZW5zaW9uICsgM10pO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHNldFZlY3RvckFycmF5KHZlY3RvcnM6IFZlY3RvckJhc2VbXSwgb2Zmc2V0ID0gMCk6IHZvaWQge1xuICAgIGlmICh2ZWN0b3JzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLl92ZXJpZnlEaW1lbnNpb24odmVjdG9yc1swXSk7XG4gICAgdmVjdG9ycy5mb3JFYWNoKChlLCBpKSA9PiB7XG4gICAgICBpZiAodGhpcy5fZGltZW5zaW9uICE9PSBlLkVsZW1lbnRDb3VudCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVubWF0Y2ggdW5pdCBzaXplIG9mIHZlY3RvciBlbGVtZW50ISBhdDoke2l9YCk7XG4gICAgICB9XG4gICAgICBmb3IgKGxldCBlbGVtSW5kZXggPSAwOyBlbGVtSW5kZXggPCB0aGlzLl9kaW1lbnNpb247IGVsZW1JbmRleCsrKSB7XG4gICAgICAgIHRoaXMucmF3RWxlbWVudHNbb2Zmc2V0ICsgdGhpcy5fZGltZW5zaW9uICogaSArIGVsZW1JbmRleF0gPSBlLnJhd0VsZW1lbnRzW2VsZW1JbmRleF07XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgcHVibGljIGdldFZlY3RvckFycmF5PFQgZXh0ZW5kcyBWZWN0b3JCYXNlPigpOiBUW10ge1xuICAgIGlmICh0aGlzLnJhd0VsZW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgICBjb25zdCByZXN1bHQgPSBuZXcgQXJyYXkodGhpcy5yYXdFbGVtZW50cy5sZW5ndGggLyB0aGlzLl9kaW1lbnNpb24pO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmVzdWx0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICByZXN1bHRbaV0gPSB0aGlzLmdldFZlY3RvcjxUPihpKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgZGltZW5zaW9uKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuX2RpbWVuc2lvbjtcbiAgfVxuXG4gIHByaXZhdGUgX3ZlcmlmeURpbWVuc2lvbih2ZWN0b3I6IFZlY3RvckJhc2UpOiB2b2lkIHtcbiAgICBpZiAodHlwZW9mIHRoaXMuX2RpbWVuc2lvbiAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0aGlzLl9kaW1lbnNpb24gIT09IHZlY3Rvci5FbGVtZW50Q291bnQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlVubWF0Y2ggdW5pdCBzaXplIG9mIHZlY3RvcnMhXCIpO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIHRoaXMuX2RpbWVuc2lvbiA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgdGhpcy5fZGltZW5zaW9uID0gdmVjdG9yLkVsZW1lbnRDb3VudDtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgVmVjdG9yQXJyYXk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=

import ContextComponents from "../../ContextComponents";
import JThreeContext from "../../JThreeContext";
import JThreeLogger from "../../Base/JThreeLogger";
import Q from "q";
class PMXTextureManager {
    constructor(model) {
        this._model = model;
    }
    generateSharedToonImg(index) {
        if (PMXTextureManager.imgConvertedToons[index]) {
            return PMXTextureManager.imgConvertedToons[index];
        }
        else {
            const imgTag = document.createElement("img");
            imgTag.src = PMXTextureManager._toons[index];
            PMXTextureManager.imgConvertedToons[index] = imgTag;
            return imgTag;
        }
    }
    loadTexture(index) {
        const deferred = Q.defer();
        if (index < 0) {
            process.nextTick(() => {
                deferred.resolve(null);
            });
            return deferred.promise;
        }
        this._model.loadingTextureCount++;
        const rm = JThreeContext.getContextComponent(ContextComponents.ResourceManager);
        return rm.loadTexture(this._model.modelDirectory + this._model.ModelData.Textures[index]).then((texture) => {
            process.nextTick(() => {
                this._model.loadedTextureCount++;
                JThreeLogger.sectionLog("pmx texture", `loaded texture ${this._model.loadedTextureCount} / ${this._model.loadingTextureCount}`);
                if (this._model.loadingTextureCount === this._model.loadedTextureCount) {
                    this._model.emit("load", this._model);
                }
                deferred.resolve(texture);
            });
            return deferred.promise;
        }, (error) => {
            process.nextTick(() => {
                this._model.loadedTextureCount++;
                JThreeLogger.sectionError("pmx texture", `load failure texture ${this._model.loadedTextureCount} / ${this._model.loadingTextureCount}  ${error}`);
                if (this._model.loadingTextureCount === this._model.loadedTextureCount) {
                    this._model.emit("load", this._model);
                }
                deferred.reject(error);
            });
            return deferred.promise;
        });
    }
}
PMXTextureManager.imgConvertedToons = [];
PMXTextureManager._toons = [
    "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAABlBMVEX////Nzc1XNMFjAAAAD0lEQVQI12OgNvgPBFQkAPcnP8G6A9XkAAAAAElFTkSuQmCC",
    "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAABlBMVEX////14eF2pXIGAAAAD0lEQVQI12OgNvgPBFQkAPcnP8G6A9XkAAAAAElFTkSuQmCC",
    "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAABlBMVEX///+ampo+MvaSAAAAD0lEQVQI12OgNvgPBFQkAPcnP8G6A9XkAAAAAElFTkSuQmCC",
    "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAABlBMVEX////47+sAKyXFAAAAD0lEQVQI12OgNvgPBFQkAPcnP8G6A9XkAAAAAElFTkSuQmCC",
    "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEX/////5t3/6N7/7eX/+fb/9PD//Pv/8Op5dFmOAAAAQklEQVQoz2MYBRQDtjQYgAq4gEAIiEiBCIYiAEjYjaEcBIrLoSA0lMEYDTAooQEGRQgtqAgTEEQD5AgoYQggAFgOAHEkIrrgwCawAAAAAElFTkSuQmCC",
    "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAflBMVEX/7WHDrAPErQT/7mT/7mn66Fj86VvizTLJswz/8of/8Hf/73L+7F7NtxLLtQ7/7mb///z//ez//OL/+9vs2ELk0Db//vX/+L7/723o1DzRvBjFrgX/+sz/+Lr/9qzw3Uj/+tL/97b/9Jf/85D/9Z//8X//6DHFrgb/+MD/5AUNrqVlAAAAwklEQVQ4y+XO226DMAwAUG/OutmhgyQQkgYYl162///BmaoV7UPFc9XzYlu2bMNrQrhS16hyRMxVCLlSgWrNmpkPvP8lDogKutb4Qbvajc5b6xpr92071qbvTMNMPfjCdzgVoulJkx2oNW4wtulqYl8YoIkVaq1lOcB8Sy4hjk4SDHTQd+8tcLokR1jxByuO8CKybDP7uLE5y84AyrKMsaqqz4VUMUZp/AjYbcW3+FrM5VbsBJxSen8kpXSCtxVPMfAPmVcPlflaGvEAAAAASUVORK5CYII=",
    "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAC0lEQVQI12MY5AAAAKAAAfgHMzoAAAAASUVORK5CYII=",
    "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAC0lEQVQI12MY5AAAAKAAAfgHMzoAAAAASUVORK5CYII=",
    "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAC0lEQVQI12MY5AAAAKAAAfgHMzoAAAAASUVORK5CYII=",
    "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAC0lEQVQI12MY5AAAAKAAAfgHMzoAAAAASUVORK5CYII="
];
export default PMXTextureManager;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlBNWC9Db3JlL1BNWFRleHR1cmVNYW5hZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJPQUNPLGlCQUFpQixNQUFNLHlCQUF5QjtPQUVoRCxhQUFhLE1BQU0scUJBQXFCO09BRXhDLFlBQVksTUFBTSx5QkFBeUI7T0FDM0MsQ0FBQyxNQUFNLEdBQUc7QUFDakI7SUFtQkUsWUFBWSxLQUFlO1FBQ3pCLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO0lBQ3RCLENBQUM7SUFFTSxxQkFBcUIsQ0FBQyxLQUFhO1FBQ3hDLEVBQUUsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMvQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsaUJBQWlCLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDcEQsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sTUFBTSxNQUFNLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUM3QyxNQUFNLENBQUMsR0FBRyxHQUFHLGlCQUFpQixDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUM3QyxpQkFBaUIsQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLENBQUMsR0FBRyxNQUFNLENBQUM7WUFDcEQsTUFBTSxDQUFDLE1BQU0sQ0FBQztRQUNoQixDQUFDO0lBQ0gsQ0FBQztJQUVNLFdBQVcsQ0FBQyxLQUFhO1FBQzlCLE1BQU0sUUFBUSxHQUFHLENBQUMsQ0FBQyxLQUFLLEVBQWUsQ0FBQztRQUN4QyxFQUFFLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNkLE9BQU8sQ0FBQyxRQUFRLENBQUM7Z0JBQ2YsUUFBUSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN6QixDQUFDLENBQUMsQ0FBQztZQUNILE1BQU0sQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDO1FBQzFCLENBQUM7UUFDRCxJQUFJLENBQUMsTUFBTSxDQUFDLG1CQUFtQixFQUFFLENBQUM7UUFDbEMsTUFBTSxFQUFFLEdBQUcsYUFBYSxDQUFDLG1CQUFtQixDQUFrQixpQkFBaUIsQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUNqRyxNQUFNLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQWMsQ0FBQyxPQUFPO1lBQ2xILE9BQU8sQ0FBQyxRQUFRLENBQUM7Z0JBQ2YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO2dCQUNqQyxZQUFZLENBQUMsVUFBVSxDQUFDLGFBQWEsRUFBRSxrQkFBa0IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsTUFBTSxJQUFJLENBQUMsTUFBTSxDQUFDLG1CQUFtQixFQUFFLENBQUMsQ0FBQztnQkFDaEksRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxtQkFBbUIsS0FBSyxJQUFJLENBQUMsTUFBTSxDQUFDLGtCQUFrQixDQUFDLENBQUMsQ0FBQztvQkFDdkUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDeEMsQ0FBQztnQkFDRCxRQUFRLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQzVCLENBQUMsQ0FBQyxDQUFDO1lBQ0gsTUFBTSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUM7UUFDMUIsQ0FBQyxFQUFFLENBQUMsS0FBSztZQUNMLE9BQU8sQ0FBQyxRQUFRLENBQUM7Z0JBQ2YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO2dCQUNqQyxZQUFZLENBQUMsWUFBWSxDQUFDLGFBQWEsRUFBRSx3QkFBd0IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsTUFBTSxJQUFJLENBQUMsTUFBTSxDQUFDLG1CQUFtQixLQUFLLEtBQUssRUFBRSxDQUFDLENBQUM7Z0JBQ2xKLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsbUJBQW1CLEtBQUssSUFBSSxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUM7b0JBQ3ZFLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQ3hDLENBQUM7Z0JBQ0QsUUFBUSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUN6QixDQUFDLENBQUMsQ0FBQztZQUNILE1BQU0sQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDO1FBQzFCLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztBQUNILENBQUM7QUFqRWUsbUNBQWlCLEdBQXVCLEVBQUUsQ0FBQztBQUUxQyx3QkFBTSxHQUFhO0lBQ2hDLGdKQUFnSjtJQUNoSixnSkFBZ0o7SUFDaEosZ0pBQWdKO0lBQ2hKLGdKQUFnSjtJQUNoSiw0T0FBNE87SUFDNU8sZ2lCQUFnaUI7SUFDaGlCLHdJQUF3STtJQUN4SSx3SUFBd0k7SUFDeEksd0lBQXdJO0lBQ3hJLHdJQUF3STtDQUN6SSxDQW9ERjtBQUVELGVBQWUsaUJBQWlCLENBQUMiLCJmaWxlIjoiUE1YL0NvcmUvUE1YVGV4dHVyZU1hbmFnZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgVGV4dHVyZUJhc2UgZnJvbSBcIi4uLy4uL0NvcmUvUmVzb3VyY2VzL1RleHR1cmUvVGV4dHVyZUJhc2VcIjtcbmltcG9ydCBDb250ZXh0Q29tcG9uZW50cyBmcm9tIFwiLi4vLi4vQ29udGV4dENvbXBvbmVudHNcIjtcbmltcG9ydCBSZXNvdXJjZU1hbmFnZXIgZnJvbSBcIi4uLy4uL0NvcmUvUmVzb3VyY2VNYW5hZ2VyXCI7XG5pbXBvcnQgSlRocmVlQ29udGV4dCBmcm9tIFwiLi4vLi4vSlRocmVlQ29udGV4dFwiO1xuaW1wb3J0IFBNWE1vZGVsIGZyb20gXCIuL1BNWE1vZGVsXCI7XG5pbXBvcnQgSlRocmVlTG9nZ2VyIGZyb20gXCIuLi8uLi9CYXNlL0pUaHJlZUxvZ2dlclwiO1xuaW1wb3J0IFEgZnJvbSBcInFcIjtcbmNsYXNzIFBNWFRleHR1cmVNYW5hZ2VyIHtcbiAgcHVibGljIHN0YXRpYyBpbWdDb252ZXJ0ZWRUb29uczogSFRNTEltYWdlRWxlbWVudFtdID0gW107XG5cbiAgcHJpdmF0ZSBzdGF0aWMgX3Rvb25zOiBzdHJpbmdbXSA9IFtcbiAgICBcImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQ0FBQUFBZ0FRTUFBQUJKdE9pM0FBQUFCbEJNVkVYLy8vL056YzFYTk1GakFBQUFEMGxFUVZRSTEyT2dOdmdQQkZRa0FQY25QOEc2QTlYa0FBQUFBRWxGVGtTdVFtQ0NcIixcbiAgICBcImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQ0FBQUFBZ0FRTUFBQUJKdE9pM0FBQUFCbEJNVkVYLy8vLzE0ZUYycFhJR0FBQUFEMGxFUVZRSTEyT2dOdmdQQkZRa0FQY25QOEc2QTlYa0FBQUFBRWxGVGtTdVFtQ0NcIixcbiAgICBcImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQ0FBQUFBZ0FRTUFBQUJKdE9pM0FBQUFCbEJNVkVYLy8vK2FtcG8rTXZhU0FBQUFEMGxFUVZRSTEyT2dOdmdQQkZRa0FQY25QOEc2QTlYa0FBQUFBRWxGVGtTdVFtQ0NcIixcbiAgICBcImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQ0FBQUFBZ0FRTUFBQUJKdE9pM0FBQUFCbEJNVkVYLy8vLzQ3K3NBS3lYRkFBQUFEMGxFUVZRSTEyT2dOdmdQQkZRa0FQY25QOEc2QTlYa0FBQUFBRWxGVGtTdVFtQ0NcIixcbiAgICBcImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQ0FBQUFBZ0JBTUFBQUNCVkdmSEFBQUFHRkJNVkVYLy8vLy81dDMvNk43LzdlWC8rZmIvOVBELy9Qdi84T3A1ZEZtT0FBQUFRa2xFUVZRb3oyTVlCUlFEdGpRWWdBcTRnRUFJaUVpQkNJWWlBRWpZamFFY0JJckxvU0EwbE1FWURUQW9vUUVHUlFndHFBZ1RFRVFENUFnb1lRZ2dBRmdPQUhFa0lycmd3Q2F3QUFBQUFFbEZUa1N1UW1DQ1wiLFxuICAgIFwiZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFDQUFBQUFnQ0FNQUFBQkVwSXJHQUFBQWZsQk1WRVgvN1dIRHJBUEVyUVQvN21ULzdtbjY2Rmo4NlZ2aXpUTEpzd3ovOG9mLzhIZi83M0wrN0Y3TnR4TEx0UTcvN21iLy8vei8vZXovL09MLys5dnMyRUxrMERiLy92WC8rTDcvNzIzbzFEelJ2QmpGcmdYLytzei8rTHIvOXF6dzNVai8rdEwvOTdiLzlKZi84NUQvOVovLzhYLy82REhGcmdiLytNRC81QVVOcnFWbEFBQUF3a2xFUVZRNHkrWE8yMjZETUF3QVVHL091dG1oZ3lRUWtnWVlsMTYyLy8vQm1hb1Y3VVBGYzlYellsdTJiTU5yUXJoUzE2aHlSTXhWQ0xsU2dXck5tcGtQdlA4bERvZ0t1dGI0UWJ2YWpjNWI2eHByOTIwNzFxYnZUTU5NUGZqQ2R6Z1ZvdWxKa3gyb05XNHd0dWxxWWw4WW9Ja1ZhcTFsT2NCOFN5NGhqazRTREhUUWQrOHRjTG9rUjFqeEJ5dU84Q0t5YkRQN3VMRTV5ODRBeXJLTXNhcXF6NFZVTVVacC9BalliY1czK0ZyTTVWYnNCSnhTZW44a3BYU0N0eFZQTWZBUG1WY1BsZmxhR3ZFQUFBQUFTVVZPUks1Q1lJST1cIixcbiAgICBcImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQ0FBQUFBZ0FRTUFBQUJKdE9pM0FBQUFBMUJNVkVYLy8vK254QnZJQUFBQUMwbEVRVlFJMTJNWTVBQUFBS0FBQWZnSE16b0FBQUFBU1VWT1JLNUNZSUk9XCIsXG4gICAgXCJkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUNBQUFBQWdBUU1BQUFCSnRPaTNBQUFBQTFCTVZFWC8vLytueEJ2SUFBQUFDMGxFUVZRSTEyTVk1QUFBQUtBQUFmZ0hNem9BQUFBQVNVVk9SSzVDWUlJPVwiLFxuICAgIFwiZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFDQUFBQUFnQVFNQUFBQkp0T2kzQUFBQUExQk1WRVgvLy8rbnhCdklBQUFBQzBsRVFWUUkxMk1ZNUFBQUFLQUFBZmdITXpvQUFBQUFTVVZPUks1Q1lJST1cIixcbiAgICBcImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQ0FBQUFBZ0FRTUFBQUJKdE9pM0FBQUFBMUJNVkVYLy8vK254QnZJQUFBQUMwbEVRVlFJMTJNWTVBQUFBS0FBQWZnSE16b0FBQUFBU1VWT1JLNUNZSUk9XCJcbiAgXTtcblxuICBwcml2YXRlIF9tb2RlbDogUE1YTW9kZWw7XG5cblxuICBjb25zdHJ1Y3Rvcihtb2RlbDogUE1YTW9kZWwpIHtcbiAgICB0aGlzLl9tb2RlbCA9IG1vZGVsO1xuICB9XG5cbiAgcHVibGljIGdlbmVyYXRlU2hhcmVkVG9vbkltZyhpbmRleDogbnVtYmVyKTogSFRNTEltYWdlRWxlbWVudCB7XG4gICAgaWYgKFBNWFRleHR1cmVNYW5hZ2VyLmltZ0NvbnZlcnRlZFRvb25zW2luZGV4XSkge1xuICAgICAgcmV0dXJuIFBNWFRleHR1cmVNYW5hZ2VyLmltZ0NvbnZlcnRlZFRvb25zW2luZGV4XTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgaW1nVGFnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImltZ1wiKTtcbiAgICAgIGltZ1RhZy5zcmMgPSBQTVhUZXh0dXJlTWFuYWdlci5fdG9vbnNbaW5kZXhdO1xuICAgICAgUE1YVGV4dHVyZU1hbmFnZXIuaW1nQ29udmVydGVkVG9vbnNbaW5kZXhdID0gaW1nVGFnO1xuICAgICAgcmV0dXJuIGltZ1RhZztcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgbG9hZFRleHR1cmUoaW5kZXg6IG51bWJlcik6IFEuSVByb21pc2U8VGV4dHVyZUJhc2U+IHtcbiAgICBjb25zdCBkZWZlcnJlZCA9IFEuZGVmZXI8VGV4dHVyZUJhc2U+KCk7XG4gICAgaWYgKGluZGV4IDwgMCkge1xuICAgICAgcHJvY2Vzcy5uZXh0VGljaygoKSA9PiB7XG4gICAgICAgIGRlZmVycmVkLnJlc29sdmUobnVsbCk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH1cbiAgICB0aGlzLl9tb2RlbC5sb2FkaW5nVGV4dHVyZUNvdW50Kys7XG4gICAgY29uc3Qgcm0gPSBKVGhyZWVDb250ZXh0LmdldENvbnRleHRDb21wb25lbnQ8UmVzb3VyY2VNYW5hZ2VyPihDb250ZXh0Q29tcG9uZW50cy5SZXNvdXJjZU1hbmFnZXIpO1xuICAgIHJldHVybiBybS5sb2FkVGV4dHVyZSh0aGlzLl9tb2RlbC5tb2RlbERpcmVjdG9yeSArIHRoaXMuX21vZGVsLk1vZGVsRGF0YS5UZXh0dXJlc1tpbmRleF0pLnRoZW48VGV4dHVyZUJhc2U+KCh0ZXh0dXJlKSA9PiB7XG4gICAgICBwcm9jZXNzLm5leHRUaWNrKCgpID0+IHtcbiAgICAgICAgdGhpcy5fbW9kZWwubG9hZGVkVGV4dHVyZUNvdW50Kys7XG4gICAgICAgIEpUaHJlZUxvZ2dlci5zZWN0aW9uTG9nKFwicG14IHRleHR1cmVcIiwgYGxvYWRlZCB0ZXh0dXJlICR7dGhpcy5fbW9kZWwubG9hZGVkVGV4dHVyZUNvdW50fSAvICR7dGhpcy5fbW9kZWwubG9hZGluZ1RleHR1cmVDb3VudH1gKTtcbiAgICAgICAgaWYgKHRoaXMuX21vZGVsLmxvYWRpbmdUZXh0dXJlQ291bnQgPT09IHRoaXMuX21vZGVsLmxvYWRlZFRleHR1cmVDb3VudCkge1xuICAgICAgICAgIHRoaXMuX21vZGVsLmVtaXQoXCJsb2FkXCIsIHRoaXMuX21vZGVsKTtcbiAgICAgICAgfVxuICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHRleHR1cmUpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9LCAoZXJyb3IpID0+IHtcbiAgICAgICAgcHJvY2Vzcy5uZXh0VGljaygoKSA9PiB7XG4gICAgICAgICAgdGhpcy5fbW9kZWwubG9hZGVkVGV4dHVyZUNvdW50Kys7XG4gICAgICAgICAgSlRocmVlTG9nZ2VyLnNlY3Rpb25FcnJvcihcInBteCB0ZXh0dXJlXCIsIGBsb2FkIGZhaWx1cmUgdGV4dHVyZSAke3RoaXMuX21vZGVsLmxvYWRlZFRleHR1cmVDb3VudH0gLyAke3RoaXMuX21vZGVsLmxvYWRpbmdUZXh0dXJlQ291bnR9ICAke2Vycm9yfWApO1xuICAgICAgICAgIGlmICh0aGlzLl9tb2RlbC5sb2FkaW5nVGV4dHVyZUNvdW50ID09PSB0aGlzLl9tb2RlbC5sb2FkZWRUZXh0dXJlQ291bnQpIHtcbiAgICAgICAgICAgIHRoaXMuX21vZGVsLmVtaXQoXCJsb2FkXCIsIHRoaXMuX21vZGVsKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgICAgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUE1YVGV4dHVyZU1hbmFnZXI7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=

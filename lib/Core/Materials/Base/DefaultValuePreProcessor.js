import MatrixArray from "../../../Math/MatrixArray";
import VectorArray from "../../../Math/VectorArray";
import Matrix from "../../../Math/Matrix";
import Vector2 from "../../../Math/Vector2";
import Vector3 from "../../../Math/Vector3";
import Vector4 from "../../../Math/Vector4";
import isArray from "lodash.isarray";
class DefaultValuePreProcessor {
    static preprocess(uniforms) {
        for (let variableName in uniforms) {
            const uniform = uniforms[variableName];
            if (!uniform.isArray) {
                switch (uniform.variableType) {
                    case "float":
                        DefaultValuePreProcessor._forFloat(variableName, uniform);
                        continue;
                    case "vec2":
                        DefaultValuePreProcessor._forVec2(variableName, uniform);
                        continue;
                    case "vec3":
                        DefaultValuePreProcessor._forVec3(variableName, uniform);
                        continue;
                    case "vec4":
                        DefaultValuePreProcessor._forVec4(variableName, uniform);
                        continue;
                    case "mat4":
                        DefaultValuePreProcessor._forMat4(variableName, uniform);
                        continue;
                }
            }
            else {
                // When this uniform is array.
                switch (uniform.variableType) {
                    case "float":
                        DefaultValuePreProcessor._forFloatArray(variableName, uniform);
                        continue;
                    case "vec2":
                        DefaultValuePreProcessor._forVectorarray(variableName, 2, uniform);
                        continue;
                    case "vec3":
                        DefaultValuePreProcessor._forVectorarray(variableName, 3, uniform);
                        continue;
                    case "vec4":
                        DefaultValuePreProcessor._forVectorarray(variableName, 4, uniform);
                        continue;
                    case "mat4":
                        DefaultValuePreProcessor._forMat4Array(variableName, uniform);
                        continue;
                }
            }
        }
    }
    static _forFloat(name, uniform) {
        if (!uniform.variableAnnotation["default"]) {
            uniform.variableAnnotation["default"] = 0;
        }
    }
    static _forFloatArray(name, uniform) {
        if (!uniform.variableAnnotation["default"]) {
            const defaultValue = new Array(uniform.arrayLength);
            for (let i = 0; i < defaultValue.length; i++) {
                defaultValue[i] = 0; // [0,0,0.....0,0] will be used as default
            }
            uniform.variableAnnotation["default"] = defaultValue.slice(0, uniform.arrayLength);
        }
    }
    static _forVectorarray(name, dimension, uniform) {
        const defaultArray = VectorArray.zeroVectorArray(dimension, uniform.arrayLength);
        const defaultValue = uniform.variableAnnotation["default"];
        if (isArray(defaultValue)) {
            if (isArray(defaultValue[0])) {
                for (let i = 0; i < defaultValue.length; i++) {
                    defaultArray.setRawArray(i, defaultValue[i]);
                }
            }
            else {
                for (let i = 0; i < defaultValue.length; i++) {
                    defaultArray.rawElements[i] = defaultValue[i];
                }
            }
        }
        uniform.variableAnnotation["defualt"] = defaultArray;
    }
    static _forVec2(name, uniform) {
        const defaultValue = uniform.variableAnnotation["default"];
        const annotations = uniform.variableAnnotation;
        if (defaultValue) {
            if (Array.isArray(defaultValue)) {
                annotations["default"] = new Vector2(defaultValue[0], defaultValue[1]); // parse array as vector
            }
            else if (typeof defaultValue === "string") {
                annotations["default"] = Vector2.parse(defaultValue); // parse string representation as vector
            }
            else {
                console.error(`Unknown default value ${defaultValue}`);
                annotations["default"] = new Vector2(0, 0);
            }
        }
        else {
            annotations["default"] = new Vector2(0, 0); // use (0,0) as default when the default annotation was not specified
        }
    }
    static _forVec3(name, uniform) {
        const defaultValue = uniform.variableAnnotation["default"];
        const annotations = uniform.variableAnnotation;
        if (defaultValue) {
            if (Array.isArray(defaultValue)) {
                annotations["default"] = new Vector3(defaultValue[0], defaultValue[1], defaultValue[2]); // parse array as vector
            }
            else if (typeof defaultValue === "string") {
                annotations["default"] = Vector3.parse(defaultValue); // parse string representation as vector
            }
            else {
                console.error(`Unknown default value ${defaultValue}`);
                annotations["default"] = new Vector3(0, 0, 0);
            }
        }
        else {
            annotations["default"] = new Vector3(0, 0, 0); // use (0,0,0) as default when the default annotation was not specified
        }
    }
    static _forVec4(name, uniform) {
        const defaultValue = uniform.variableAnnotation["default"];
        const annotations = uniform.variableAnnotation;
        if (defaultValue) {
            if (Array.isArray(defaultValue)) {
                annotations["default"] = new Vector4(defaultValue[0], defaultValue[1], defaultValue[2], defaultValue[3]); // parse array as vector
            }
            else if (typeof defaultValue === "string") {
                annotations["default"] = Vector4.parse(defaultValue); // parse string representation as vector
            }
            else {
                console.error(`Unknown default value ${defaultValue}`);
                annotations["default"] = new Vector4(0, 0, 0, 0);
            }
        }
        else {
            annotations["default"] = new Vector4(0, 0, 0, 0); // use (0,0,0,0) as default when the default annotation was not specified
        }
    }
    static _forMat4(name, uniform) {
        const defaultValue = uniform.variableAnnotation["default"];
        const annotations = uniform.variableAnnotation;
        if (defaultValue) {
            if (Array.isArray(defaultValue)) {
                annotations["default"] = Matrix.fromElements.apply(defaultValue);
            }
            else {
                console.error(`Unknown default value ${defaultValue}`);
                annotations["default"] = Matrix.identity();
            }
        }
        else {
            annotations["default"] = Matrix.identity();
        }
    }
    static _forMat4Array(name, uniform) {
        const defaultValue = uniform.variableAnnotation["default"];
        uniform.variableAnnotation["default"] = MatrixArray.getIdentityMatrixArray(uniform.arrayLength);
        if (defaultValue) {
            if (isArray(defaultValue)) {
                for (let i = 0; i < defaultValue.length; i++) {
                    uniform.variableAnnotation["default"].rawElements[i] = defaultValue[i];
                }
            }
        }
    }
}
export default DefaultValuePreProcessor;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNvcmUvTWF0ZXJpYWxzL0Jhc2UvRGVmYXVsdFZhbHVlUHJlUHJvY2Vzc29yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJPQUFPLFdBQVcsTUFBTSwyQkFBMkI7T0FDNUMsV0FBVyxNQUFNLDJCQUEyQjtPQUM1QyxNQUFNLE1BQU0sc0JBQXNCO09BQ2xDLE9BQU8sTUFBTSx1QkFBdUI7T0FDcEMsT0FBTyxNQUFNLHVCQUF1QjtPQUNwQyxPQUFPLE1BQU0sdUJBQXVCO09BRXBDLE9BQU8sTUFBTSxnQkFBZ0I7QUFDcEM7SUFDRSxPQUFjLFVBQVUsQ0FBQyxRQUFrRDtRQUN6RSxHQUFHLENBQUMsQ0FBQyxJQUFJLFlBQVksSUFBSSxRQUFRLENBQUMsQ0FBQyxDQUFDO1lBQ2xDLE1BQU0sT0FBTyxHQUFHLFFBQVEsQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUN2QyxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO2dCQUNyQixNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztvQkFDN0IsS0FBSyxPQUFPO3dCQUNWLHdCQUF3QixDQUFDLFNBQVMsQ0FBQyxZQUFZLEVBQUUsT0FBTyxDQUFDLENBQUM7d0JBQzFELFFBQVEsQ0FBQztvQkFDWCxLQUFLLE1BQU07d0JBQ1Qsd0JBQXdCLENBQUMsUUFBUSxDQUFDLFlBQVksRUFBRSxPQUFPLENBQUMsQ0FBQzt3QkFDekQsUUFBUSxDQUFDO29CQUNYLEtBQUssTUFBTTt3QkFDVCx3QkFBd0IsQ0FBQyxRQUFRLENBQUMsWUFBWSxFQUFFLE9BQU8sQ0FBQyxDQUFDO3dCQUN6RCxRQUFRLENBQUM7b0JBQ1gsS0FBSyxNQUFNO3dCQUNULHdCQUF3QixDQUFDLFFBQVEsQ0FBQyxZQUFZLEVBQUUsT0FBTyxDQUFDLENBQUM7d0JBQ3pELFFBQVEsQ0FBQztvQkFDWCxLQUFLLE1BQU07d0JBQ1Qsd0JBQXdCLENBQUMsUUFBUSxDQUFDLFlBQVksRUFBRSxP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LFlBQVksQ0FBQyxDQUFDLENBQUM7WUFDakIsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDMUIsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxZQUFZLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7b0JBQzdDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxTQUFTLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLEdBQUcsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUN6RSxDQUFDO1lBQ0gsQ0FBQztRQUNILENBQUM7SUFDSCxDQUFDO0FBQ0gsQ0FBQztBQUVELGVBQWUsd0JBQXdCLENBQUMiLCJmaWxlIjoiQ29yZS9NYXRlcmlhbHMvQmFzZS9EZWZhdWx0VmFsdWVQcmVQcm9jZXNzb3IuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTWF0cml4QXJyYXkgZnJvbSBcIi4uLy4uLy4uL01hdGgvTWF0cml4QXJyYXlcIjtcbmltcG9ydCBWZWN0b3JBcnJheSBmcm9tIFwiLi4vLi4vLi4vTWF0aC9WZWN0b3JBcnJheVwiO1xuaW1wb3J0IE1hdHJpeCBmcm9tIFwiLi4vLi4vLi4vTWF0aC9NYXRyaXhcIjtcbmltcG9ydCBWZWN0b3IyIGZyb20gXCIuLi8uLi8uLi9NYXRoL1ZlY3RvcjJcIjtcbmltcG9ydCBWZWN0b3IzIGZyb20gXCIuLi8uLi8uLi9NYXRoL1ZlY3RvcjNcIjtcbmltcG9ydCBWZWN0b3I0IGZyb20gXCIuLi8uLi8uLi9NYXRoL1ZlY3RvcjRcIjtcbmltcG9ydCBJVmFyaWFibGVEZXNjcmlwdGlvbiBmcm9tIFwiLi9JVmFyaWFibGVEZXNjcmlwdGlvblwiO1xuaW1wb3J0IGlzQXJyYXkgZnJvbSBcImxvZGFzaC5pc2FycmF5XCI7XG5jbGFzcyBEZWZhdWx0VmFsdWVQcmVQcm9jZXNzb3Ige1xuICBwdWJsaWMgc3RhdGljIHByZXByb2Nlc3ModW5pZm9ybXM6IHsgW25hbWU6IHN0cmluZ106IElWYXJpYWJsZURlc2NyaXB0aW9uIH0pOiB2b2lkIHtcbiAgICBmb3IgKGxldCB2YXJpYWJsZU5hbWUgaW4gdW5pZm9ybXMpIHtcbiAgICAgIGNvbnN0IHVuaWZvcm0gPSB1bmlmb3Jtc1t2YXJpYWJsZU5hbWVdO1xuICAgICAgaWYgKCF1bmlmb3JtLmlzQXJyYXkpIHsgLy8gV2hlbiB0aGlzIHVuaWZvcm0gaXMgbm90IGFycmF5ICwganVzdCBhIGVsZW1lbnQuXG4gICAgICAgIHN3aXRjaCAodW5pZm9ybS52YXJpYWJsZVR5cGUpIHtcbiAgICAgICAgICBjYXNlIFwiZmxvYXRcIjpcbiAgICAgICAgICAgIERlZmF1bHRWYWx1ZVByZVByb2Nlc3Nvci5fZm9yRmxvYXQodmFyaWFibGVOYW1lLCB1bmlmb3JtKTtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIGNhc2UgXCJ2ZWMyXCI6XG4gICAgICAgICAgICBEZWZhdWx0VmFsdWVQcmVQcm9jZXNzb3IuX2ZvclZlYzIodmFyaWFibGVOYW1lLCB1bmlmb3JtKTtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIGNhc2UgXCJ2ZWMzXCI6XG4gICAgICAgICAgICBEZWZhdWx0VmFsdWVQcmVQcm9jZXNzb3IuX2ZvclZlYzModmFyaWFibGVOYW1lLCB1bmlmb3JtKTtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIGNhc2UgXCJ2ZWM0XCI6XG4gICAgICAgICAgICBEZWZhdWx0VmFsdWVQcmVQcm9jZXNzb3IuX2ZvclZlYzQodmFyaWFibGVOYW1lLCB1bmlmb3JtKTtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIGNhc2UgXCJtYXQ0XCI6XG4gICAgICAgICAgICBEZWZhdWx0VmFsdWVQcmVQcm9jZXNzb3IuX2Zvck1hdDQodmFyaWFibGVOYW1lLCB1bmlmb3JtKTtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBXaGVuIHRoaXMgdW5pZm9ybSBpcyBhcnJheS5cbiAgICAgICAgc3dpdGNoICh1bmlmb3JtLnZhcmlhYmxlVHlwZSkge1xuICAgICAgICAgIGNhc2UgXCJmbG9hdFwiOlxuICAgICAgICAgICAgRGVmYXVsdFZhbHVlUHJlUHJvY2Vzc29yLl9mb3JGbG9hdEFycmF5KHZhcmlhYmxlTmFtZSwgdW5pZm9ybSk7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICBjYXNlIFwidmVjMlwiOlxuICAgICAgICAgICAgRGVmYXVsdFZhbHVlUHJlUHJvY2Vzc29yLl9mb3JWZWN0b3JhcnJheSh2YXJpYWJsZU5hbWUsIDIsIHVuaWZvcm0pO1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgY2FzZSBcInZlYzNcIjpcbiAgICAgICAgICAgIERlZmF1bHRWYWx1ZVByZVByb2Nlc3Nvci5fZm9yVmVjdG9yYXJyYXkodmFyaWFibGVOYW1lLCAzLCB1bmlmb3JtKTtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIGNhc2UgXCJ2ZWM0XCI6XG4gICAgICAgICAgICBEZWZhdWx0VmFsdWVQcmVQcm9jZXNzb3IuX2ZvclZlY3RvcmFycmF5KHZhcmlhYmxlTmFtZSwgNCwgdW5pZm9ybSk7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICBjYXNlIFwibWF0NFwiOlxuICAgICAgICAgICAgRGVmYXVsdFZhbHVlUHJlUHJvY2Vzc29yLl9mb3JNYXQ0QXJyYXkodmFyaWFibGVOYW1lLCB1bmlmb3JtKTtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHN0YXRpYyBfZm9yRmxvYXQobmFtZTogc3RyaW5nLCB1bmlmb3JtOiBJVmFyaWFibGVEZXNjcmlwdGlvbik6IHZvaWQge1xuICAgIGlmICghdW5pZm9ybS52YXJpYWJsZUFubm90YXRpb25bXCJkZWZhdWx0XCJdKSB7XG4gICAgICB1bmlmb3JtLnZhcmlhYmxlQW5ub3RhdGlvbltcImRlZmF1bHRcIl0gPSAwO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc3RhdGljIF9mb3JGbG9hdEFycmF5KG5hbWU6IHN0cmluZywgdW5pZm9ybTogSVZhcmlhYmxlRGVzY3JpcHRpb24pOiB2b2lkIHtcbiAgICBpZiAoIXVuaWZvcm0udmFyaWFibGVBbm5vdGF0aW9uW1wiZGVmYXVsdFwiXSkge1xuICAgICAgY29uc3QgZGVmYXVsdFZhbHVlID0gbmV3IEFycmF5KHVuaWZvcm0uYXJyYXlMZW5ndGgpO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkZWZhdWx0VmFsdWUubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgZGVmYXVsdFZhbHVlW2ldID0gMDsgLy8gWzAsMCwwLi4uLi4wLDBdIHdpbGwgYmUgdXNlZCBhcyBkZWZhdWx0XG4gICAgICB9XG4gICAgICB1bmlmb3JtLnZhcmlhYmxlQW5ub3RhdGlvbltcImRlZmF1bHRcIl0gPSBkZWZhdWx0VmFsdWUuc2xpY2UoMCwgdW5pZm9ybS5hcnJheUxlbmd0aCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgX2ZvclZlY3RvcmFycmF5KG5hbWU6IHN0cmluZywgZGltZW5zaW9uOiBudW1iZXIsIHVuaWZvcm06IElWYXJpYWJsZURlc2NyaXB0aW9uKTogdm9pZCB7XG4gICAgY29uc3QgZGVmYXVsdEFycmF5ID0gVmVjdG9yQXJyYXkuemVyb1ZlY3RvckFycmF5KGRpbWVuc2lvbiwgdW5pZm9ybS5hcnJheUxlbmd0aCk7XG4gICAgY29uc3QgZGVmYXVsdFZhbHVlID0gdW5pZm9ybS52YXJpYWJsZUFubm90YXRpb25bXCJkZWZhdWx0XCJdO1xuICAgIGlmIChpc0FycmF5KGRlZmF1bHRWYWx1ZSkpIHtcbiAgICAgIGlmIChpc0FycmF5KGRlZmF1bHRWYWx1ZVswXSkpIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkZWZhdWx0VmFsdWUubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBkZWZhdWx0QXJyYXkuc2V0UmF3QXJyYXkoaSwgZGVmYXVsdFZhbHVlW2ldKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkZWZhdWx0VmFsdWUubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBkZWZhdWx0QXJyYXkucmF3RWxlbWVudHNbaV0gPSBkZWZhdWx0VmFsdWVbaV07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgdW5pZm9ybS52YXJpYWJsZUFubm90YXRpb25bXCJkZWZ1YWx0XCJdID0gZGVmYXVsdEFycmF5O1xuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgX2ZvclZlYzIobmFtZTogc3RyaW5nLCB1bmlmb3JtOiBJVmFyaWFibGVEZXNjcmlwdGlvbik6IHZvaWQge1xuICAgIGNvbnN0IGRlZmF1bHRWYWx1ZSA9IHVuaWZvcm0udmFyaWFibGVBbm5vdGF0aW9uW1wiZGVmYXVsdFwiXTtcbiAgICBjb25zdCBhbm5vdGF0aW9ucyA9IHVuaWZvcm0udmFyaWFibGVBbm5vdGF0aW9uO1xuICAgIGlmIChkZWZhdWx0VmFsdWUpIHtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KGRlZmF1bHRWYWx1ZSkpIHtcbiAgICAgICAgYW5ub3RhdGlvbnNbXCJkZWZhdWx0XCJdID0gbmV3IFZlY3RvcjIoZGVmYXVsdFZhbHVlWzBdLCBkZWZhdWx0VmFsdWVbMV0pOyAvLyBwYXJzZSBhcnJheSBhcyB2ZWN0b3JcbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGRlZmF1bHRWYWx1ZSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICBhbm5vdGF0aW9uc1tcImRlZmF1bHRcIl0gPSBWZWN0b3IyLnBhcnNlKGRlZmF1bHRWYWx1ZSk7IC8vIHBhcnNlIHN0cmluZyByZXByZXNlbnRhdGlvbiBhcyB2ZWN0b3JcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYFVua25vd24gZGVmYXVsdCB2YWx1ZSAke2RlZmF1bHRWYWx1ZX1gKTtcbiAgICAgICAgYW5ub3RhdGlvbnNbXCJkZWZhdWx0XCJdID0gbmV3IFZlY3RvcjIoMCwgMCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGFubm90YXRpb25zW1wiZGVmYXVsdFwiXSA9IG5ldyBWZWN0b3IyKDAsIDApOyAvLyB1c2UgKDAsMCkgYXMgZGVmYXVsdCB3aGVuIHRoZSBkZWZhdWx0IGFubm90YXRpb24gd2FzIG5vdCBzcGVjaWZpZWRcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHN0YXRpYyBfZm9yVmVjMyhuYW1lOiBzdHJpbmcsIHVuaWZvcm06IElWYXJpYWJsZURlc2NyaXB0aW9uKTogdm9pZCB7XG4gICAgY29uc3QgZGVmYXVsdFZhbHVlID0gdW5pZm9ybS52YXJpYWJsZUFubm90YXRpb25bXCJkZWZhdWx0XCJdO1xuICAgIGNvbnN0IGFubm90YXRpb25zID0gdW5pZm9ybS52YXJpYWJsZUFubm90YXRpb247XG4gICAgaWYgKGRlZmF1bHRWYWx1ZSkge1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZGVmYXVsdFZhbHVlKSkge1xuICAgICAgICBhbm5vdGF0aW9uc1tcImRlZmF1bHRcIl0gPSBuZXcgVmVjdG9yMyhkZWZhdWx0VmFsdWVbMF0sIGRlZmF1bHRWYWx1ZVsxXSwgZGVmYXVsdFZhbHVlWzJdKTsgLy8gcGFyc2UgYXJyYXkgYXMgdmVjdG9yXG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiBkZWZhdWx0VmFsdWUgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgYW5ub3RhdGlvbnNbXCJkZWZhdWx0XCJdID0gVmVjdG9yMy5wYXJzZShkZWZhdWx0VmFsdWUpOyAvLyBwYXJzZSBzdHJpbmcgcmVwcmVzZW50YXRpb24gYXMgdmVjdG9yXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmVycm9yKGBVbmtub3duIGRlZmF1bHQgdmFsdWUgJHtkZWZhdWx0VmFsdWV9YCk7XG4gICAgICAgIGFubm90YXRpb25zW1wiZGVmYXVsdFwiXSA9IG5ldyBWZWN0b3IzKDAsIDAsIDApO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBhbm5vdGF0aW9uc1tcImRlZmF1bHRcIl0gPSBuZXcgVmVjdG9yMygwLCAwLCAwKTsgLy8gdXNlICgwLDAsMCkgYXMgZGVmYXVsdCB3aGVuIHRoZSBkZWZhdWx0IGFubm90YXRpb24gd2FzIG5vdCBzcGVjaWZpZWRcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHN0YXRpYyBfZm9yVmVjNChuYW1lOiBzdHJpbmcsIHVuaWZvcm06IElWYXJpYWJsZURlc2NyaXB0aW9uKTogdm9pZCB7XG4gICAgY29uc3QgZGVmYXVsdFZhbHVlID0gdW5pZm9ybS52YXJpYWJsZUFubm90YXRpb25bXCJkZWZhdWx0XCJdO1xuICAgIGNvbnN0IGFubm90YXRpb25zID0gdW5pZm9ybS52YXJpYWJsZUFubm90YXRpb247XG4gICAgaWYgKGRlZmF1bHRWYWx1ZSkge1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZGVmYXVsdFZhbHVlKSkge1xuICAgICAgICBhbm5vdGF0aW9uc1tcImRlZmF1bHRcIl0gPSBuZXcgVmVjdG9yNChkZWZhdWx0VmFsdWVbMF0sIGRlZmF1bHRWYWx1ZVsxXSwgZGVmYXVsdFZhbHVlWzJdLCBkZWZhdWx0VmFsdWVbM10pOyAvLyBwYXJzZSBhcnJheSBhcyB2ZWN0b3JcbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGRlZmF1bHRWYWx1ZSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICBhbm5vdGF0aW9uc1tcImRlZmF1bHRcIl0gPSBWZWN0b3I0LnBhcnNlKGRlZmF1bHRWYWx1ZSk7IC8vIHBhcnNlIHN0cmluZyByZXByZXNlbnRhdGlvbiBhcyB2ZWN0b3JcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYFVua25vd24gZGVmYXVsdCB2YWx1ZSAke2RlZmF1bHRWYWx1ZX1gKTtcbiAgICAgICAgYW5ub3RhdGlvbnNbXCJkZWZhdWx0XCJdID0gbmV3IFZlY3RvcjQoMCwgMCwgMCwgMCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGFubm90YXRpb25zW1wiZGVmYXVsdFwiXSA9IG5ldyBWZWN0b3I0KDAsIDAsIDAsIDApOyAvLyB1c2UgKDAsMCwwLDApIGFzIGRlZmF1bHQgd2hlbiB0aGUgZGVmYXVsdCBhbm5vdGF0aW9uIHdhcyBub3Qgc3BlY2lmaWVkXG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgX2Zvck1hdDQobmFtZTogc3RyaW5nLCB1bmlmb3JtOiBJVmFyaWFibGVEZXNjcmlwdGlvbik6IHZvaWQge1xuICAgIGNvbnN0IGRlZmF1bHRWYWx1ZSA9IHVuaWZvcm0udmFyaWFibGVBbm5vdGF0aW9uW1wiZGVmYXVsdFwiXTtcbiAgICBjb25zdCBhbm5vdGF0aW9ucyA9IHVuaWZvcm0udmFyaWFibGVBbm5vdGF0aW9uO1xuICAgIGlmIChkZWZhdWx0VmFsdWUpIHtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KGRlZmF1bHRWYWx1ZSkpIHtcbiAgICAgICAgYW5ub3RhdGlvbnNbXCJkZWZhdWx0XCJdID0gTWF0cml4LmZyb21FbGVtZW50cy5hcHBseShkZWZhdWx0VmFsdWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihgVW5rbm93biBkZWZhdWx0IHZhbHVlICR7ZGVmYXVsdFZhbHVlfWApO1xuICAgICAgICBhbm5vdGF0aW9uc1tcImRlZmF1bHRcIl0gPSBNYXRyaXguaWRlbnRpdHkoKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgYW5ub3RhdGlvbnNbXCJkZWZhdWx0XCJdID0gTWF0cml4LmlkZW50aXR5KCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgX2Zvck1hdDRBcnJheShuYW1lOiBzdHJpbmcsIHVuaWZvcm06IElWYXJpYWJsZURlc2NyaXB0aW9uKTogdm9pZCB7XG4gICAgY29uc3QgZGVmYXVsdFZhbHVlID0gdW5pZm9ybS52YXJpYWJsZUFubm90YXRpb25bXCJkZWZhdWx0XCJdO1xuICAgIHVuaWZvcm0udmFyaWFibGVBbm5vdGF0aW9uW1wiZGVmYXVsdFwiXSA9IE1hdHJpeEFycmF5LmdldElkZW50aXR5TWF0cml4QXJyYXkodW5pZm9ybS5hcnJheUxlbmd0aCk7XG4gICAgaWYgKGRlZmF1bHRWYWx1ZSkge1xuICAgICAgaWYgKGlzQXJyYXkoZGVmYXVsdFZhbHVlKSkge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRlZmF1bHRWYWx1ZS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIHVuaWZvcm0udmFyaWFibGVBbm5vdGF0aW9uW1wiZGVmYXVsdFwiXS5yYXdFbGVtZW50c1tpXSA9IGRlZmF1bHRWYWx1ZVtpXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBEZWZhdWx0VmFsdWVQcmVQcm9jZXNzb3I7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
